"use strict";(function(){!function(o,a){var i,s,t,r;if(o&&o.customize)(s=o.customize).PositionControl=s.Control.extend({ready:function(){var t;return t=this,_.bindAll(t,"startPositioning","cancelPositioning","stopPositioning","removePosition"),t.container.on("click keydown",".start-button",t.startPositioning),t.container.on("click keydown",".done-button",t.stopPositioning),t.container.on("click keydown",".cancel-button",t.cancelPositioning),t.container.on("click keydown",".remove-button",t.removePosition),t.state=new s.Value("default"),t.aspectRatio=new s.Value(null),t.setting.bind(function(e){return t.params.position=e?e.split(","):null,t.renderContent()}),t.state.bind(function(e){return t.params.state=e,t.renderContent()}),s.previewer.bind("voucher:update-position:"+t.params.voucher_field_id,function(e){return t.setting.set(e)}),s.previewer.bind("voucher:click-position:"+t.params.voucher_field_id,function(){return t.focus(),t.startPositioning()}),a(document).on("keydown",function(e){if(27===e.keyCode&&"positioning"===t.state.get()&&t.cancelPositioning(),13===e.keyCode&&"positioning"===t.state.get())return t.stopPositioning()}),s.bind("save",function(){return t.stopPositioning()})},startPositioning:function(){var e;return this.current_value=this.setting.get(),this.state.set("positioning"),e={field_id:this.params.voucher_field_id,aspect_ratio:this.aspectRatio.get()},s.previewer.send("voucher:start-positioning",e)},removePosition:function(){return this.setting.set(""),this.state.set("default"),s.previewer.send("voucher:remove-position",this.params.voucher_field_id)},cancelPositioning:function(){return this.current_value&&this.setting.set(this.current_value?this.current_value:""),this.stopPositioning()},stopPositioning:function(){return this.state.set("default"),s.previewer.send("voucher:stop-positioning",this.params.voucher_field_id)}}),s.BarcodePositionControl=s.PositionControl.extend({ready:function(){var o;return o=this,s.PositionControl.prototype.ready.call(o),o.aspectRatio.set(o.params.aspect_ratio[s.get().wc_voucher_template_barcode_barcode_type]),s.bind("change",function(e){var t;if(-1!==e.id.indexOf("barcode_type"))return t=s.get().wc_voucher_template_barcode_barcode_type,o.aspectRatio.set(o.params.aspect_ratio[t]),"qr"!==t?s.notifications.add(new s.Notification("only_qr_scanning",{message:woocommerce_vouchers_admin_customizer.i18n.something,type:"warning",dismissible:!0})):s.notifications.remove("only_qr_scanning"),s.PositionControl.prototype.stopPositioning.call(o),s.PositionControl.prototype.startPositioning.call(o)})}}),s.VoucherImageControl=s.HeaderControl.extend({ready:function(){return this.btnNew=a("#customize-control-wc_pdf_product_vouchers_voucher_image .actions .new"),_.bindAll(this,"openMedia"),this.btnNew.on("click",this.openMedia),s.HeaderTool.currentHeader=this.getInitialVoucherImage(),new s.VoucherCurrentImageView({model:s.HeaderTool.currentHeader,el:"#customize-control-wc_pdf_product_vouchers_voucher_image .current .container"}),new s.HeaderTool.ChoiceListView({collection:s.HeaderTool.UploadsList=new s.VoucherImageChoiceList,el:"#customize-control-wc_pdf_product_vouchers_voucher_image .choices .uploaded .list"}),new s.HeaderTool.ChoiceListView({collection:s.HeaderTool.DefaultsList=new s.VoucherImageDefaultsList,el:"#customize-control-wc_pdf_product_vouchers_voucher_image .choices .default .list"}),s.HeaderTool.combinedList=s.HeaderTool.CombinedList=new s.HeaderTool.CombinedList([s.HeaderTool.UploadsList,s.HeaderTool.DefaultsList]),o.media.controller.Cropper.prototype.defaults.doCropArgs.wp_customize="on",o.media.controller.Cropper.prototype.defaults.doCropArgs.customize_theme=s.settings.theme.stylesheet},getInitialVoucherImage:function(){var e,t;return(t=s.get().wc_voucher_template_voucher_primary_image)&&_wpCustomizeHeader.uploads[t.id]?(e=_wpCustomizeHeader.uploads[t.id],new s.VoucherImageModel({header:e,choice:e.url.split("/").pop()})):new s.VoucherImageModel},openMedia:function(e){var t;return t=_wpMediaViewsL10n,e.preventDefault(),this.frame=new i({button:{text:t.select,close:!1},states:[new o.media.controller.Library({title:t.chooseImage,library:o.media.query({type:"image"}),defaults:o.media.query({type:"image",include:_wpCustomizeHeader._pdf_vouchers.default_images}),multiple:!1,date:!1,priority:20,suggestedWidth:_wpCustomizeHeader.data.width,suggestedHeight:_wpCustomizeHeader.data.height})]}),this.frame.on("select",this.onSelect,this),this.frame.open()},onSelect:function(){var e;return e=this.frame.state().get("selection").first().toJSON(),this.setImageFromURL(e.url,e.id,e.width,e.height),this.frame.close()},setImageFromURL:function(e,t,o,i){var r,n;return(n={}).url=e,n.thumbnail_url=e,n.timestamp=_.now(),t&&(n.attachment_id=t),o&&(n.width=o),i&&(n.height=i),r=new s.VoucherImageModel({header:n,choice:e.split("/").pop()}),s.HeaderTool.UploadsList.add(r),s.HeaderTool.currentHeader.set(r.toJSON()),r.save(),r.importImage()}}),s.VoucherImageModel=s.HeaderTool.ImageModel.extend({destroy:function(){var e,t,o,i,r;return t=this.get("header"),e=s.HeaderTool.currentHeader.get("header").attachment_id,-1<(i=(o=_.clone(s("wc_voucher_template_voucher_images").get())||[]).indexOf(t.attachment_id))&&o.splice(i,1),s("wc_voucher_template_voucher_images").set(o),e&&t.attachment_id===e&&((r=this.collection.at(1))?(r.save(),s.HeaderTool.currentHeader.set(r.toJSON())):s.HeaderTool.currentHeader.trigger("hide")),this.trigger("destroy",this,this.collection)},save:function(){var e;return e=this.get("header"),s("wc_voucher_template_voucher_primary_image").set({id:e.attachment_id,src:e.url,width:e.width,height:e.height}),s.HeaderTool.combinedList.trigger("control:setImage",this)},importImage:function(){var e,t;if(void 0!==(e=this.get("header")).attachment_id)return(t=_.clone(s("wc_voucher_template_voucher_images").get())||[]).push(e.attachment_id),s("wc_voucher_template_voucher_images").set(t)}}),s.VoucherImageChoiceList=s.HeaderTool.ChoiceList.extend({model:s.VoucherImageModel,addRandomChoice:function(){}}),s.VoucherImageDefaultsList=s.HeaderTool.DefaultsList.extend({model:s.VoucherImageModel,addRandomChoice:function(){}}),s.VoucherCurrentImageView=s.HeaderTool.CurrentView.extend({getHeight:function(){var e;return(e=this.$el.find("img")).length?(this.$el.find(".inner").hide(),e.height()||"auto"):(this.$el.find(".inner").show(),40)}}),s.bind("ready",function(){var i;return i=s.previewer.query,s.previewer.query=function(){var e,t,o;return o=i.call(this),t=r(window.location.search.substr(1)).url,(e=document.createElement("a")).href=t,o.voucher_template_id=r(e.search).p,o},s("wc_voucher_template_allow_online_redemptions",function(e){var t;return t=function(){return s("wc_voucher_template_voucher_number_pos",function(e){if(!e.get())return e._dirty=!0})},e.get()&&t(),e.bind(function(e){if(e)return t()})})}),a.extend(s.controlConstructor,{wc_pdf_product_vouchers_position:s.PositionControl,wc_pdf_product_vouchers_voucher_image:s.VoucherImageControl,wc_pdf_product_vouchers_barcode_position:s.BarcodePositionControl}),r=function(e){var t,o;return t=e.split("&"),o={},t.forEach(function(e){var t;if(2===(t=e.split("=",2)).length)return o[t[0]]=decodeURIComponent(t[1].replace(/\+/g," "))}),o},t=function(){return a("#tiptip_holder").removeAttr("style"),a("#tiptip_arrow").removeAttr("style"),a(".font-style-button").tipTip({attribute:"data-tip",fadeIn:0,fadeOut:0,delay:0})},a(function(){var e,o;if(woocommerce_vouchers_admin_customizer.wc_gte_3_2||a("#customize-control-wc_voucher_template_allow_online_redemptions input").prop("disabled",!0),t(),a(".customize-info .customize-panel-description").text(woocommerce_vouchers_admin_customizer.i18n.customizer_description),s("wc_voucher_template_post_title",function(e){return e.get()||(e._dirty=!0),e.bind(function(e){var t;return t=e||woocommerce_vouchers_admin_customizer.i18n.untitled_template,a(".customize-info .site-title").text(t)})}),a("#customize-control-wc_voucher_template_logo_image_id img.attachment-thumb").on("load",function(){var e;return e=a(this).width()+":"+a(this).height(),s.control.value("wc_voucher_template_logo_pos").aspectRatio.set(e)}),s("wc_voucher_template_logo_image_id",function(e){var n;return n=s.control.value("wc_voucher_template_logo_pos"),e.get()||(n.aspectRatio.set(""),n.state.set("")),e.bind(function(e){return e?(n.state.set("default"),a("#customize-control-wc_voucher_template_logo_image_id img.attachment-thumb").on("load",function(){var e,t,o,i,r;if(i=(r=a(this).width())+":"+(t=a(this).height()),o=n.setting.get(),n.aspectRatio.set(i),o)return(e=n.setting.get().split(",").map(function(e){return parseInt(e,10)}))[3]=Math.round(t/r*e[2]),o=e.join(","),n.setting.set(o),s.previewer.send("voucher:update-position","wc_voucher_template_logo_pos")})):(n.aspectRatio.set(""),n.state.set(""),n.setting.set(""),s.previewer.send("voucher:remove-position","wc_voucher_template_logo_pos"))})}),a(".customize-control-wc_pdf_product_vouchers_font_style input").on("change",function(e){var t;return t=a(e.target).closest(".font-style-button"),"radio"===e.target.type&&t.siblings().removeClass("active"),t[a(e.target).is(":checked")?"addClass":"removeClass"]("active")}).on("click",function(e){var t;if("radio"===e.target.type&&(t=a(e.target).closest(".font-style-button")).hasClass("active"))return a(e.target).removeAttr("checked"),t.removeClass("active").siblings(".font-style-text-align-empty").prop("checked",!0).change()}),e=a('input[type="range"]'))return e.each(function(){return a(this).closest("label").append('<span class="wc-pdf-product-vouchers-range-index"></span>')}),o=function(e){var t,o;return t=0<(o=a(e).val())?o+"px":woocommerce_vouchers_admin_customizer.i18n.default,a(e).parent().find(".wc-pdf-product-vouchers-range-index").text(t)},e.on("input",function(){return o(this)}),e.each(function(e,t){return o(t)})}),i=o.media.view.MediaFrame.Select.extend({bindHandlers:function(){return o.media.view.MediaFrame.Select.prototype.bindHandlers.apply(this,arguments),this.on("content:render:defaults",this.defaultsContent,this)},browseRouter:function(e){return e.set({upload:{text:_wpMediaViewsL10n.uploadFilesTitle,priority:20},browse:{text:_wpMediaViewsL10n.mediaLibraryTitle,priority:40},defaults:{text:_wpCustomizeHeader._pdf_vouchers.i18n.default_images_title,priority:60}})},defaultsContent:function(){var e;return e=this.state(),this.content.set(new o.media.view.AttachmentsBrowser({controller:this,collection:e.get("defaults"),selection:e.get("selection"),model:e,sortable:!1,search:!1,filters:!1,date:e.get("date"),display:e.has("display")?e.get("display"):e.get("displaySettings"),dragInfo:e.get("dragInfo"),idealColumnWidth:e.get("idealColumnWidth"),suggestedWidth:e.get("suggestedWidth"),suggestedHeight:e.get("suggestedHeight"),AttachmentView:e.get("AttachmentView")}))}})}(window.wp,jQuery)}).call(void 0);