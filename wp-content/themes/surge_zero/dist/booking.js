!function(c){function t(t){for(var e,n,r=t[0],i=t[1],s=t[2],o=0,a=[];o<r.length;o++)n=r[o],u[n]&&a.push(u[n][0]),u[n]=0;for(e in i)Object.prototype.hasOwnProperty.call(i,e)&&(c[e]=i[e]);for(h&&h(t);a.length;)a.shift()();return l.push.apply(l,s||[]),d()}function d(){for(var t,e=0;e<l.length;e++){for(var n=l[e],r=!0,i=1;i<n.length;i++){var s=n[i];0!==u[s]&&(r=!1)}r&&(l.splice(e--,1),t=o(o.s=n[0]))}return t}var n={},u={2:0},l=[];function o(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return c[t].call(e.exports,e,e.exports,o),e.l=!0,e.exports}o.m=c,o.c=n,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="";var e=window.webpackJsonp=window.webpackJsonp||[],r=e.push.bind(e);e.push=t,e=e.slice();for(var i=0;i<e.length;i++)t(e[i]);var h=r;l.push([147,1,0]),d()}({147:function(t,e,n){"use strict";n.r(e);var q=n(7),V=n(6),o=n(12),F=n(8),J=n(11),W=n(10),r=n(0),$=n.n(r),p=n(1);function i(t,e,n){this.trackId=t,this.trackInfo=e,this.targetEl=n,this.eventTypes=[],this.eventReservations={},this.timeslots=[]}i.prototype.getEventTypes=function(i){return new Promise(function(e,n){var r=this,t=i.base_url+"eventTypes?key="+i.api+"&limit="+i.limit+'&where={"deleted":"false", "trackId":'+this.trackId+"}";fetch(t).then(function(t){return i.checkResponse(t)}).then(function(t){return i.returnJson(t)}).then(function(t){t.forEach(function(t){this.eventTypes.push(t.eventTypeId)}.bind(r)),e(t)}).catch(function(t){n(t)})}.bind(this))},i.prototype.getEventReservations=function(i,s,o){return new Promise(function(e,n){var r=this,t=o.base_url+"eventReservations?key="+o.api+"&limit="+o.limit+'&where={"status":{"$in":[0,1,2,3,6]}, "deleted":"false", "startTime": {"$gte":"'+i+'T00:00:00", "$lte":"'+s+'T23:59:00"}, "eventTypeId":{"in":['+this.eventTypes+"]}}";fetch(t).then(function(t){return o.checkResponse(t)}).then(function(t){return o.returnJson(t)}).then(function(t){t.forEach(function(t){this.eventReservations[t.eventReservationId]=t}.bind(r)),e(t)}).catch(function(t){n(t)})}.bind(this))},i.prototype.drawEvents=function(t,e){var n=this.targetEl;if(this.eventReservations)for(var r=Object.keys(this.eventReservations),i=0;i<r.length;i++){var s=r[i],o=this.eventReservations[s],a=$()(o.startTime).format("kmm"),c=$()(o.endTime).format("kmm");if(parseInt(a,10)<parseInt(t.start,10)&&parseInt(c,10)>parseInt(t.start,10)&&(a=t.start),parseInt(c,10)>parseInt(t.end,10)&&parseInt(a,10)<parseInt(t.end,10)&&(c=t.end),parseInt(a,10)>=parseInt(t.start,10)&&parseInt(c,10)<=parseInt(t.end,10)){var d=document.createElement("article");if(this.addColumnChildClass(d),d.id=o.eventReservationId,d.classList.add("schedule-event"),d.style.cssText="grid-row: row"+a+" / row"+c+"; grid-column: colEvent"+this.trackId+" / span 1;",-1<Object.keys(e).map(function(t){return parseInt(t,10)}).indexOf(o.eventReservationId)){var u=Object(p.g)(e[o.eventReservationId].title),l=Object(p.d)("h4","My Event"),h=document.createElement("a");h.href="/cart",h.target="_self",d.appendChild(l),d.appendChild(u),d.appendChild(h),d.classList.add("my-event")}else d.classList.add("hidden");n.appendChild(d)}}},i.prototype.drawSelectHeader=function(t){var e=document.createElement("select");for(var n in e.setAttribute("data-current",this.trackId),this.addColumnChildClass(e),e.style.cssText="grid-row: 1 / span 1; grid-column: colEvent"+this.trackId+" / span 1",t.track_info){var r=t.track_info[n],i=Array.from(t.other_tracks);if(i.push(t.main),i.indexOf(parseInt(r.track_id,10))<0||parseInt(r.track_id,10)===this.trackId){var s=document.createElement("option"),o=document.createTextNode(r.track_name);s.value=r.track_id,parseInt(r.track_id,10)===this.trackId&&(s.selected=!0),s.appendChild(o),e.appendChild(s)}}return this.targetEl.appendChild(e),e},i.prototype.drawClosed=function(t,e,n){console.log(t);var r=document.getElementById("schedule"),i=$()(t).format("dddd").toLowerCase(),s=e.opening_hours[i].open.replace(":",""),o=e.opening_hours[i].close.replace(":",""),a=e.opening_hours[i].closed;if(console.log(e,i,a),a){var c=document.createElement("article");this.addColumnChildClass(c),c.classList.add("schedule-event"),c.classList.add("closed"),c.style.cssText="grid-row: row"+parseInt(n.start,10)+" / row"+parseInt(n.end,10)+"; grid-column: colEvent"+this.trackId+" / span 1;",r.appendChild(c)}else{if(parseInt(s,10)>parseInt(n.start,10)){var d=document.createElement("article");this.addColumnChildClass(d),d.classList.add("schedule-event"),d.classList.add("closed"),d.style.cssText="grid-row: row"+parseInt(n.start,10)+" / row"+parseInt(s,10)+"; grid-column: colEvent"+this.trackId+" / span 1;",r.appendChild(d)}if(parseInt(o,10)<parseInt(n.end,10)){var u=document.createElement("article");this.addColumnChildClass(u),u.classList.add("schedule-event"),u.classList.add("closed"),u.style.cssText="grid-row: row"+parseInt(o,10)+" / row"+parseInt(n.end,10)+"; grid-column: colEvent"+this.trackId+" / span 1;",r.appendChild(u)}}},i.prototype.addColumnChildClass=function(t){t.classList.add("track-"+this.trackId+"-item")};var s=i,a=n(2);function c(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function d(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,e=1<arguments.length?arguments[1]:void 0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:800,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:2200,i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:30,s=5<arguments.length?arguments[5]:void 0,o=6<arguments.length?arguments[6]:void 0;this.targetEl=t,this.date=e,this.start=n,this.end=r,this.period=i,this.tracks=s,this.api=o,this.trackWrappers={},this.colWidth="minmax(14rem, 24rem)"}d.prototype.modifyStartTime=function(t){this.start=t,this.modifyRowTemplate()},d.prototype.modifyEndTime=function(t){this.end=t,this.modifyRowTemplate()},d.prototype.modifyRowTemplate=function(){for(var t=$()(this.start,"Hmm"),e=$()(this.end,"Hmm"),n=t.clone(),r="[trackname] minmax(2rem, 1fr)";n<=e;){var i=n.format("kmm"),s=n.format("H:mm");if(r+=" [row"+i+"] minmax(2rem, 1fr)",document.getElementsByClassName(i).length<1){var o=document.createElement("div"),a=document.createElement("h4"),c=document.createTextNode(s);o.classList.add("time"),0===n.format("m")&&o.classList.add("hour"),o.style.gridRow="row"+i+" / span 1",a.appendChild(c),o.appendChild(a),this.targetEl.appendChild(o)}n.add(this.period,"m")}this.targetEl.style.gridTemplateRows=r},d.prototype.renderOtherTracks=function(i){return new Promise(function(t,e){this.setGridColumnsTemplate(),this.tracks.other_tracks.forEach(function(e){var n=this,r=new s(e,this.tracks.track_info[e],this.targetEl);this.startLoading(e),r.getEventTypes(this.api).then(function(t){return r.getEventReservations(n.date,n.date,n.api)}).then(function(t){r.drawSelectHeader(n.tracks).addEventListener("change",n.changeTrack.bind(n)),r.drawEvents(scheduleSettings,i),console.log(n),r.drawClosed(n.date,n.tracks.track_info[e],scheduleSettings),n.stopLoading(e)}).catch(function(t){console.error(t)})}.bind(this))}.bind(this))},d.prototype.changeTrack=function(t){var e=t.target,n=parseInt(e.getAttribute("data-current"),10),r=parseInt(t.target.value,10);e.setAttribute("data-current",r);var i=this.tracks.other_tracks.indexOf(n);this.tracks.other_tracks[i]=r,c(document.getElementsByClassName("track-"+n+"-item")).forEach(function(t){t.remove()}),this.renderOtherTracks()},d.prototype.setGridColumnsTemplate=function(){var e="[times] 3.5rem [main] "+this.colWidth+" ";this.tracks.other_tracks.forEach(function(t){e+="[colEvent"+t+"] "+this.colWidth+" "}.bind(this)),this.targetEl.style.gridTemplateColumns=e},d.prototype.startLoading=function(t){if(0==t){var e=this.drawTrackWrapper(0);Object(a.a)(e)}else{var n=this.drawTrackWrapper(t);Object(a.a)(n)}},d.prototype.stopLoading=function(t){if(0==t){var e=document.getElementsByClassName("main-track")[0];Object(a.b)(e)}else{var n=document.getElementsByClassName("track-"+t)[0];Object(a.b)(n)}},d.prototype.drawTrackWrapper=function(t){var e=document.createElement("div");return e.classList.add("track-wrapper"),0==t?(e.style.cssText="grid-column: main / span 1; grid-row: 2 / -1",e.classList.add("main-track"),this.trackWrappers.mainTrack=e):(e.style.cssText="grid-column: colEvent"+t+" / span 1; grid-row: 2 / -1",e.classList.add("track-"+t),e.classList.add("track-"+t+"-item"),this.trackWrappers["track-"+t]=e),this.targetEl.appendChild(e),e};var u=d;function l(t,e,n,r,i){this.customerId=t,this.email=e,this.firstName=n,this.lastName=r,this.telephone=i||null}l.prototype.checkCustomerExists=function(r){return new Promise(function(e,n){var t=r.base_url+"customers?key="+r.api+'&select=customerId&where={"email":"'+this.email+'"}';fetch(t).then(function(t){if(!t.ok)throw Error(t.statusText);return t}).then(function(t){return t.json()}).then(function(t){t.length?e(t[0].customerId):e(!1)}).catch(function(t){n(t)})}.bind(this))},l.prototype.createCustomerOnApi=function(i){return new Promise(function(e,n){var t=$()().format("YYYY-MM-DDTHH:mm:ss"),r=i.base_url+"customers?key="+i.api+"&accountCreated="+t+"&email="+this.email+"&firstname="+this.firstName+"&lastname="+this.lastName+"&phoneNumber="+this.telephone;fetch(r,{method:"POST"}).then(function(t){if(!t.ok)throw Error(t.statusText);return t}).then(function(t){return t.json()}).then(function(t){e(t)}).catch(function(t){n(t)})}.bind(this))},l.prototype.setCustomer=function(r){return new Promise(function(e,t){var n=this;this.customerId?e(this.customerId):this.checkCustomerExists(r).then(function(t){return t||n.createCustomerOnApi(r)}).then(function(t){n.customerId=t,e(t)})}.bind(this))};var U=l,T=n(15),k=n(14),Q=n(3),G=n(9),f=n(4);function z(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function h(t,e,n,r,i,s,o,a,c,d,u,l,h,p,m,v,f,y,g,I,T,k,b,w,E){this.wcProductId=t,this.wcEventTitle=e,this.bookingQty=n,this.qtyCadets=r,this.qtyInduction=i,this.eventTypeId=s,this.siblingEventTypeIds=o.map(function(t){return parseInt(t,10)}),this.eventDayInfo=a,this.startDate=c,this.endDate=d,this.duration=u,this.inductionInfo=l,this.currentUser=h,this.customerId=p,this.partyInfo=m,this.singleReservation=f,this.setTimesOnly=y,this.schedule=v,this.scheduleSettings=g,this.api=I,this.newReservations=T,this.myEvents=k,this.wcPrice=b,this.wcRegularPrice=w,this.onSale=E,this.eventReservations={},this.otherEventTypeIds={trackEventTypes:[],otherTracks:{}},this.eventType={},this.eventHeatTypes=[],this.product={},this.productVariations={},this.maxRacersFromHeatTypes={cadets:null,total:null},this.timeslots=[]}h.prototype.getEventTypes=function(s){return new Promise(function(e,n){var r=this,i=this.api,t=i.base_url+"eventTypes?key="+i.api+"&limit="+i.limit+'&where={"deleted":"false", "trackId":{"in":['+s+"]}}";fetch(t).then(function(t){return i.checkResponse(t)}).then(function(t){return i.returnJson(t)}).then(function(t){return t.forEach(function(t){t.eventTypeId==this.eventTypeId?this.eventType=t:this.otherEventTypeIds.trackEventTypes.push(t.eventTypeId)}.bind(r)),i.base_url+"eventHeatTypes?key="+i.api+"&limit="+i.limit+'&where={"eventTypeId": '+r.eventTypeId+"}"}).then(function(t){return fetch(t)}).then(function(t){return i.checkResponse(t)}).then(function(t){return i.returnJson(t)}).then(function(t){t.forEach(function(t){(t.racersPerHeat<this.maxRacersFromHeatTypes.total||!this.maxRacersFromHeatTypes.total)&&(this.maxRacersFromHeatTypes.total=t.racersPerHeat),(t.cadetsPerHeat<this.maxRacersFromHeatTypes.cadets||!this.maxRacersFromHeatTypes.cadets)&&(this.maxRacersFromHeatTypes.cadets=t.cadetsPerHeat),this.eventHeatTypes.push(t)}.bind(r)),e(null)}).catch(function(t){n(t)})}.bind(this))},h.prototype.getProducts=function(i,s){return new Promise(function(t,e){var n=this,r=this.api;i&&new o.a(i).getProductById(i,r).then(function(t){n.product=t,n.product.otherProductIds=otherProductIds,n.productVariations[t.productId]={product:t,startTimes:n.eventDayInfo},n.productVariations[t.productId].product.otherProductIds=otherProductIds,n.productVariations[t.productId].product.wcPrice=n.wcPrice,n.productVariations[t.productId].product.wcRegularPrice=n.wcRegularPrice,n.productVariations[t.productId].product.onSale=n.onSale});s.length&&s.forEach(function(e){var n=this;new o.a(e.id).getProductById(e.id,r).then(function(t){n.productVariations[t.productId]={product:t,startTimes:e.startTimes,includedPeriods:e.includedPeriods,wcProductId:e.wcProductId},n.productVariations[t.productId].product.wcName=e.name,n.productVariations[t.productId].product.wcName=e.name,n.productVariations[t.productId].product.wcPrice=parseFloat(e.price,10).toFixed(2),n.productVariations[t.productId].product.wcRegularPrice=parseFloat(e.regularPrice,10).toFixed(2),n.productVariations[t.productId].product.onSale=e.onSale,n.productVariations[t.productId].product.otherProductIds=e.other_product_ids})}.bind(this)),t(!0)}.bind(this))},h.prototype.constructEventReservations=function(){return new Promise(function(a,t){var c=this,e=null,n=null,d={};this.getEventReservations().then(function(t){if(t.length)return e=t,c.getEvents(e);throw new Error("Soooorry buddy, no events today")}).then(function(t){return c.getEventReservationLinks(e)}).then(function(t){return n=t,c.getChecks(n)}).then(function(t){return t.checks.forEach(function(t){d[t.checkId]=t,d[t.checkId].checkDetails={}}),c.getCheckDetails(n)}).then(function(t){t.checkDetails.forEach(function(t){d[t.checkId].checkDetails[t.checkDetailId]=t});for(var e=Object.keys(c.eventReservations),n=0;n<e.length;n++)for(var r=e[n],i=Object.keys(c.eventReservations[r].checks),s=0;s<i.length;s++){var o=i[s];c.eventReservations[r].checks[o]=d[o]}a(!0)}).catch(function(t){a(t)})}.bind(this))},h.prototype.getEventReservations=function(){return new Promise(function(e,n){var r=this,i=this.api,s=[],t=[this.eventTypeId];t=t.concat(this.otherEventTypeIds.trackEventTypes);var o=i.base_url+"eventReservations?key="+i.api+"&limit="+i.limit+'&where={"status":{"in":[1,2,3,5,6]}, "deleted":"false", "startTime": {"$gte":"'+this.startDate+'T00:00:00", "$lte":"'+this.endDate+'T23:59:00"}, "eventTypeId":{"in":['+t+"]}}";fetch(o).then(function(t){return i.checkResponse(t)}).then(function(t){return i.returnJson(t)}).then(function(t){t.length&&t.forEach(function(t){var e=!(this.eventTypeId==t.eventTypeId||-1<this.siblingEventTypeIds.indexOf(t.eventTypeId));this.singleReservation&&(e=!0),4!==t.status&&5!==t.status||(e=!0);var n=new V.a(t.eventReservationId,t.description,t.endTime,t.eventTypeId,t.minNoOfAdultsPerBooking,t.minNoOfCadetsPerBooking,t.noOfCadetRacers,t.noOfRacers,t.noOfTotalRacers,t.notes,t.startTime,t.status,t.subject,t.externalSystemId,t.typeId,e);this.eventReservations[t.eventReservationId]=n,s.push(t.eventReservationId)}.bind(r)),e(s)}).catch(function(t){n(t)})}.bind(this))},h.prototype.getEvents=function(s){return new Promise(function(e,n){var r=this,i=this.api,t=i.base_url+"events?key="+i.api+"&limit="+i.limit+'&where={"reservationId":{"in":['+s+"]}}";fetch(t).then(function(t){return i.checkResponse(t)}).then(function(t){return i.returnJson(t)}).then(function(t){t.forEach(function(t){var e=new q.a(t.eventDesc,t.eventDuration,t.eventId,t.eventScheduledTime,t.eventTypeId,t.eventTypeName,t.reservationId,t.trackNo);this.eventReservations[t.reservationId].event=e}.bind(r)),e(!0)}).catch(function(t){n(t)})}.bind(this))},h.prototype.getEventReservationLinks=function(o){return new Promise(function(e,n){var r=this,i=this.api,s=[],t=i.base_url+"eventReservationLinks?key="+i.api+'&where={"reservationId": {"$in":['+o+"]}}";fetch(t).then(function(t){return i.checkResponse(t)}).then(function(t){return i.returnJson(t)}).then(function(t){t.forEach(function(t){this.eventReservations[t.reservationId].checks[t.checkId]={},s.push(t.checkId)}.bind(r)),e(s)}).catch(function(t){n(t)})}.bind(this))},h.prototype.getChecks=function(r){var i=this.api;return new Promise(function(e,n){var t=i.base_url+"checks?key="+i.api+'&where={"checkId": {"$in":['+r+"]}}";fetch(t).then(function(t){return i.checkResponse(t)}).then(function(t){return i.returnJson(t)}).then(function(t){e(t)}).catch(function(t){n(t)})})},h.prototype.getCheckDetails=function(r){var i=this.api;return new Promise(function(e,n){var t=i.base_url+"checkDetails?key="+i.api+'&where={"checkId": {"$in":['+r+"]}}";fetch(t).then(function(t){return i.checkResponse(t)}).then(function(t){return i.returnJson(t)}).then(function(t){e(t)}).catch(function(t){n(t)})})},h.prototype.getMyEventInfo=function(){var s=this.api;return new Promise(function(e,n){var r=this,t=Object.keys(this.myEvents);if(0<t.length){var i=s.base_url+"eventReservations?key="+s.api+"&limit="+s.limit+'&where={"eventReservationId":{"$in":['+t+"]}}";fetch(i).then(function(t){return s.checkResponse(t)}).then(function(t){return s.returnJson(t)}).then(function(t){t.forEach(function(t){this.myEvents[t.eventReservationId]&&(this.myEvents[t.eventReservationId].startTime=t.startTime,this.myEvents[t.eventReservationId].endTime=t.endTime)}.bind(r)),e(!0)}).catch(function(t){n(t)})}else e("Nothing in cart!")}.bind(this))},h.prototype.constructTimeslots=function(){for(var t=$()(this.startDate),e=$()(this.endDate),n=t;n<=e;){var r=n.clone().format("YYYY-MM-DD"),i=$()(r+" "+this.scheduleSettings.start,"YYYY-MM-DD kmm"),s=$()(r+" "+this.scheduleSettings.end,"YYYY-MM-DD kmm");for(this.timeslots[r]={times:{},eventReservations:[]};i<=s;){i.clone();var o=i.clone().format("Hmm");this.timeslots[r].times[o]=!1,this.timeslots[r].times[o]=this.checkNotTooSoon(i),i>s.clone().subtract(this.duration,"m")&&(this.timeslots[r].times[o]=!0),i.add(this.scheduleSettings.period,"m")}n.add(1,"days")}},h.prototype.checkNotTooSoon=function(t){var e={saturday:{start:9,end:22,maxGroupSize:null},sunday:{start:9,end:22,maxGroupSize:15},default:{start:12,end:18,maxGroupSize:15}};if(1==this.eventType.trackId||3==this.eventType.trackId){var n=t.format("dddd").toLowerCase(),r=e[n]?e[n]:e.default,i=$()().add(2,"h"),s=$()().add(24,"h"),o=$()(this.startDate).clone().hour(r.start),a=$()(this.startDate).clone().hour(r.end).subtract(this.duration,"m");if(t<=i)return!0;if(t<=s){if(t<o||a<t)return!0;if(r.maxGroupSize&&this.bookingQty>r.maxGroupSize)return!0}}else{var c=$()().add(48,"h");if(t.clone()<=c)return!0}return!1},h.prototype.setMaxParticipants=function(t,e){var n={saturday:{max:e},sunday:{max:15},default:{max:15}},r=t.format("dddd").toLowerCase(),i=n[r]?n[r]:n.default,s=$()().add(24,"h");return 1==this.eventType.trackId&&t<=s?i.max:e},h.prototype.fillTimeslots=function(){if(this.eventReservations)for(var t=Object.keys(this.eventReservations),e=0;e<t.length;e++){for(var n=t[e],r=this.eventReservations[n],i=$()(r.startTime),s=$()(r.endTime),o=i.clone().subtract(this.duration-this.scheduleSettings.period,"m"),a=$()(r.startTime).format("YYYY-MM-DD");o<s;){var c=o.format("Hmm");this.timeslots[a].times[c]=!0,o.add(this.scheduleSettings.period,"m")}this.timeslots[a].eventReservations.push(r.eventReservationId)}},h.prototype.overlapsEventsInCart=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,i=!1,s=$()(t),o=e?$()(e):s.clone().add(this.duration,"m"),n=Object.keys(this.myEvents);return n.length&&n.forEach(function(t){var e=this.myEvents[t],n=$()(e.startTime),r=$()(e.endTime);s.isAfter(n.subtract(30,"m"))&&s.isBefore(r.add(30,"m"))&&(i=!0),o.isAfter(n.subtract(30,"m"))&&o.isSameOrBefore(r.add(30,"m"))&&(console.info("end overlaps"),i=!0)}.bind(this)),i},h.prototype.drawEvents=function(){var t=0,e=0;if(this.eventReservations)for(var n=Object.keys(this.eventReservations),r=0;r<n.length;r++){var i=n[r],s=this.eventReservations[i],o=$()(s.startTime).format("kmm"),a=$()(s.startTime),c=$()(s.endTime).format("kmm");parseInt(this.duration,10);parseInt(o,10)<parseInt(this.schedule.start,10)&&this.schedule.modifyStartTime(parseInt(o,10)),parseInt(c,10)>parseInt(this.schedule.end,10)&&this.schedule.modifyEndTime(parseInt(c,10));var d=null,u=null,l=0,h=this.product.description;(s.eventTypeId===this.eventTypeId||-1<this.siblingEventTypeIds.indexOf(s.eventTypeId))&&!s.hidden&&((d=this.getProductVariation($()(s.startTime)))?(h=d.wcName,u=d.productId,l=s.getCurrentParticipants(this.productVariations[u].product)):this.setTimesOnly?s.hidden=!0:(d=this.product,l=s.getCurrentParticipants(this.product)));var p=this.setMaxParticipants(a,s.noOfTotalRacers);p-l<this.bookingQty&&(s.hidden=!0),this.checkNotTooSoon(a)&&(s.hidden=!0),this.overlapsEventsInCart(s.startTime,s.endTime)&&(s.hidden=!0);var m=document.createElement("article"),v=document.createElement("h4"),f=document.createTextNode(h);v.appendChild(f);var y=document.createElement("p"),g=document.createTextNode(p-l+" places remaining.");y.appendChild(g),m.id=s.eventReservationId,m.classList.add("schedule-event"),m.setAttribute("data-curr-participants",l),m.setAttribute("data-max-participants",p),m.setAttribute("data-event-type-id",s.eventTypeId),m.style.cssText="grid-row: row"+o+" / row"+c+"; grid-column: 2 / span 1;",s.hidden?(m.classList.add("hidden"),e++):(m.appendChild(v),m.appendChild(y),m.setAttribute("data-eventresid",s.eventReservationId),m.setAttribute("data-product-id",d.productId),m.addEventListener("click",this.showEventDetails.bind(this)),t++),this.schedule.targetEl.appendChild(m)}return{available:t,unavailable:e}},h.prototype.drawAddButtons=function(){var d=document.getElementById("schedule"),u=$()(this.startDate).format("YYYY-MM-DD"),t=$()(this.startDate).format("dddd").toLowerCase(),e=this.eventDayInfo[t],l=0,i=function(t,e){var n=this,r=document.createElement("div"),i=u+" "+t;if(r.setAttribute("data-start",i),r.addEventListener("click",function(t){n.showEventDetails(t,!0,null,null)}),r.classList.add("add_button"),r.style.cssText="grid-row: row"+t+" / span 1; grid-column: 2 / span 1;",e){var s=Object(f.a)(parseFloat(e.wcPrice,10),"£"),o=e.productId,a=e.wcName+" ("+s+"pp)";if(e.onSale&&e.wcRegularPrice){var c=Object(f.a)(parseFloat(e.wcRegularPrice,10),"£");a=e.wcName+" (<strike>"+c+"</strike> "+s+"pp)"}r.setAttribute("data-product-id",o),r.innerHTML=a}d.appendChild(r),l++}.bind(this);if("custom"==e.start_times)e.custom_start_times.forEach(function(t){var e=$()(u+" "+t.start_time),n=e.format("Hmm");if(!this.timeslots[u].times[n]&&!this.overlapsEventsInCart(e)){var r=this.getProductVariation($()(u+" "+t.start_time));i(n,r)}}.bind(this));else if("onthehour"==e.start_times)for(var n=Object.keys(this.timeslots[u].times),r=0;r<n.length;r++){var s=n[r],o=$()(u+"T"+s,"YYYY-MM-DDTHmm");if(0==parseInt(o.format("m"),10)&&!this.timeslots[u].times[s]&&!this.overlapsEventsInCart(o)){var a=this.getProductVariation($()(u+" "+o.format("HH:mm")));i(s,a)}}else{if("none"==e.start_times)return!1;for(var c=Object.keys(this.timeslots[u].times),h=0;h<c.length;h++){var p=c[h],m=$()(u+"T"+p,"YYYY-MM-DDTHmm");if(!this.timeslots[u].times[p]&&!this.overlapsEventsInCart(m)){var v=this.getProductVariation($()(u+" "+m.format("HH:mm")));i(p,v)}}}return l},h.prototype.showEventDetails=function(t,e,n,s){console.log(s);var o=null;o=n||(e?null:t.target.getAttribute("data-eventresid"));var a=t.target.getAttribute("data-curr-participants"),c=t.target.getAttribute("data-max-participants"),r=e?null:this.eventReservations[o],d=e?null:r.event.eventId,u=e?$()(t.target.getAttribute("data-start"),"YYYY-MM-DD Hmm"):$()(r.startTime),l=t.target.getAttribute("data-product-id"),i=l?this.productVariations[l].product:this.product,h=i.wcName,p=this.productVariations[l].wcProductId?this.productVariations[l].wcProductId:this.wcProductId,m=0<i.wcPrice?i.wcPrice:this.wcPrice,v=0<i.wcRegularPrice?i.wcRegularPrice:this.wcRegularPrice,f=i.onSale?i.onSale:this.onSale,y=inductionInfo?inductionInfo.wcPrice:null,g=this.schedule,I=null;Object(k.a)(t.target,g,"reservation_form","form").then(function(r){var i=this,t=n?1:0;return I=new T.a(r,t,s,this.bookingQty,this.qtyCadets,this.qtyInduction,m,v,f,y,this.partyInfo),r.onsubmit=this.makeReservation.bind(this),I.addFormElements(r,d,o,h,u,this.duration,l,p,this.eventType.trackId,this.currentUser,a,c,s),0<qtyInduction&&this.loadInductionStartTimes(u,I),t&&I.inductionsInput.addEventListener("change",function(t){if(0<t.target.value){var e=r.getElementsByClassName("induction-select")[0];e.style.display="block";var n=e.getElementsByClassName("induction-times")[0];0<n.getElementsByTagName("LABEL").length&&z(n.getElementsByTagName("LABEL")).forEach(function(t){t.parentNode.removeChild(t)}),0<n.getElementsByTagName("INPUT").length&&z(n.getElementsByTagName("INPUT")).forEach(function(t){t.parentNode.removeChild(t)}),i.loadInductionStartTimes(u,I),I.onQuantityChange()}}),!0}.bind(this))},h.prototype.checkAvailability=function(){var t=$()(this.startDate+"T00:00:00"),e=$()(this.endDate+"T23:59:59"),n=$()();t.isBefore(n)&&(t=n);for(var r=t.clone();r<=e;){var i=this.checkAvailabilityByDate(r),s=document.getElementById(r.format("YYYY-MM-DD"));i||s.classList.add("unavailable"),r.add(1,"d")}},h.prototype.checkAvailabilityByDate=function(t){var n=t.format("YYYY-MM-DD"),e=this.timeslots[n].eventReservations,r=t.format("dddd").toLowerCase(),i=this.eventDayInfo[r],o=!1;if(0<e.length&&e.forEach(function(t){var e=this.eventReservations[t];if(e.eventTypeId===this.eventTypeId){var n=$()(e.startTime),r=this.getProductVariation(n,!1);if(r&&r.productId===this.product.productId){var i=e.getCurrentParticipants(),s=e.noOfTotalRacers;i+this.bookingQty<=s&&(o=!0)}}}.bind(this)),o)return!0;var s=!1;if(this.newReservations)if("custom"==i.start_times)i.custom_start_times.forEach(function(t){var e=$()(n+" "+t.start_time).format("Hmm");this.timeslots[n].times[e]||(s=!0)}.bind(this));else if("onthehour"==i.start_times)for(var a=Object.keys(this.timeslots[n].times),c=0;c<a.length;c++){var d=a[c],u=$()(d,"Hmm");0==parseInt(u.format("m"),10)&&(this.timeslots[n].times[d]||(s=!0))}else{if("none"==i.start_times)return!1;for(var l=Object.keys(this.timeslots[n].times),h=0;h<l.length;h++){var p=l[h];this.timeslots[n].times[p]||(s=!0)}}return!!s},h.prototype.isValidStartTime=function(n,t){var e=n.clone().format("dddd").toLowerCase(),r=(n.clone().hour(),n.format("YYYY-MM-DD")),i=this.schedule?$()(this.schedule.start,"HHmm"):$()(r+"T08:00"),s=this.schedule?$()(this.schedule.end,"HHmm").subtract(this.duration,"m"):$()(r+"T22:00"),o="anyopen";if(void 0!==this.productVariations[t].startTimes[e]&&(o=this.productVariations[t].startTimes[e].start_times),n<i&&s<n)return!1;if("anyopen"==o)return!0;if("onthehour"==o&&0==parseInt(n.format("m"),10))return!0;if("custom"==o){var a=this.productVariations[t].startTimes[e].custom_start_times,c=!1;if(0<a.length&&(a.forEach(function(t){var e=$()(r+"T"+t.start_time);n.isSame(e)&&(c=!0)}),c))return!0}return null},h.prototype.isVariationPeriod=function(r,t){if(void 0!==this.productVariations[t].includedPeriods){var e=r.clone().format("dddd").toLowerCase(),i=(r.clone().hour(),r.format("YYYY-MM-DD"));if(0<this.productVariations[t].includedPeriods.length){var s=!1;if(this.productVariations[t].includedPeriods.forEach(function(t){-1<t.day.indexOf(e)&&0<t.included_times.length&&t.included_times.forEach(function(t){var e=$()(i+"T"+t.start_time),n=$()(i+"T"+t.end_time);r.isSameOrAfter(e)&&r.isSameOrBefore(n)&&(s=!0)})}),s)return!0}}return!1},h.prototype.getProductVariation=function(e,t){var n=null;if(this.isValidStartTime(e,this.product.productId)&&(n=this.product),void 0!==this.productVariations){var r=Object.keys(this.productVariations).map(function(t){return parseInt(t,10)}),i=null;r.forEach(function(t){t!==this.product.productId&&(this.isValidStartTime(e,t)||this.isVariationPeriod(e,t))&&(i=t)}.bind(this)),i&&(n=this.productVariations[i].product)}return n},h.prototype.loadInductionStartTimes=function(t,o){this.getInductionStartTimes(t).then(function(t){if(t){var s=5;t.forEach(function(r,i){this.checkTimeAvailable(r,3,parseInt(this.inductionInfo.event_type_id,10)).then(function(t){if(t.available&&0<s){var e=t.eventReservationId?t.eventReservationId:null,n=t.eventId?t.eventId:null;o.addInductionTime(r,i,e,n),s--}return!0})}.bind(this))}else o.noInductionsAvailable()}.bind(this))},h.prototype.getInductionStartTimes=function(l){return new Promise(function(t,e){var n=[],r=l.clone().format("dddd").toLowerCase(),i=l.clone().format("YYYY-MM-DD"),s=this.inductionInfo.duration,o=l.clone().subtract(parseInt(s,10),"m"),a=this.schedule.tracks.track_info[this.inductionInfo.track].opening_hours[r],c=$()(i+"T"+a.open);$()(i+"T"+a.close);if(a.closed)t(!1);else{var d=this.inductionInfo.event_day_info[r];if("custom"==d.start_times)d.custom_start_times.forEach(function(t){var e=$()(i+"T"+t.start_time);e<=o&&e>$()()&&n.push(e.clone())}.bind(this));else for(var u=o;c<u;)n.push(u.clone()),u.subtract(parseInt(s,10),"m");0<n.length?t(n):t(!1)}}.bind(this))},h.prototype.checkTimeAvailable=function(){var i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:$()(),o=1<arguments.length?arguments[1]:void 0,a=2<arguments.length?arguments[2]:void 0;return new Promise(function(e,n){var r=this,s=null,t=this.api.base_url+"eventTypes?key="+this.api.api+"&limit="+this.api.limit+'&where={"deleted":"false", "trackId":{"in":['+o+"]}}";fetch(t).then(function(t){return r.api.checkResponse(t)}).then(function(t){return r.api.returnJson(t)}).then(function(t){var e=[];t.forEach(function(t){e.push(t.eventTypeId)});var n=r.api.base_url+"eventReservations?key="+r.api.api+"&limit="+r.api.limit+'&where={"$and":[{"status":{"$in":[2,3]}}, {"deleted":"false"}, {"eventTypeId":{"in":['+e+']}}, {"startTime": {"$lte":"'+i.format("YYYY-MM-DDTHH:mm:ss")+'"}}, {"startTime": {"$gte":"'+i.format("YYYY-MM-DDTHH:mm:ss")+'"}}]}';return fetch(n)}).then(function(t){return r.api.checkResponse(t)}).then(function(t){return r.api.returnJson(t)}).then(function(t){if(0<t.length){(s=t[0]).event={};var e=s.eventReservationId,i=r.api.base_url+"events?key="+r.api.api+"&limit="+r.api.limit+'&where={"reservationId":'+e+"}";return new Promise(function(e,n){var r=this;fetch(i).then(function(t){return r.api.checkResponse(t)}).then(function(t){return r.api.returnJson(t)}).then(function(t){0<t.length&&(s.event=t[0]),e(t)}).catch(function(t){n(t)})}.bind(r))}return!0}).then(function(t){s?s.eventTypeId===a?e({available:!0,eventReservationId:s.eventReservationId,eventId:s.event.eventId}):e({available:!1}):e({available:!0})}).catch(function(t){n(t)})}.bind(this))},h.prototype.makeReservation=function(t){var s=this;t.preventDefault(),t.target.submitButton.disabled=!0;var e=document.createElement("div");e.classList.add("make-res-message");var n=document.createElement("p");n.innerHTML="Please wait while we connect to our booking system...",e.appendChild(n),Object(G.a)(!0,!0,e,!0);var r=t.target.elements["product-id"].value,i=this.productVariations[r].product,o=t.target.elements["wc-product-id"].value,a=t.target.elements["event-reservation-id"].value,c=t.target.elements["event-id"].value,d=$()().format("YYYY-MM-DDTHH:mm:ss"),u=t.target.elements.start.value,l=$()(u),h=l.clone().add(parseInt(this.duration,10),"m"),p=t.target.elements.subtotal.value,m=t.target.elements.qty.value,v=t.target.elements["qty-cadets"].value,f=parseInt(m,10)-parseInt(v,10),y=t.target.elements.email.value,g=t.target.elements.name.value,I=t.target.elements.telephone.value,T=g.split(" ")[0],k=g.split(" ")[g.split(" ").length-1];!function(t,e,n){if(n){var r=new Date;r.setTime(r.getTime()+60*n*1e3);var i="; expires="+r.toGMTString()}else i="";document.cookie=t+"="+e+i+"; path=/"}("emailAddr",y,10);var b=null;b=1<t.target.elements["qty-induction"].length?t.target.elements["qty-induction"].value:this.qtyInduction;var w=this.maxRacersFromHeatTypes.cadets,E=this.maxRacersFromHeatTypes.total,_=E-w,R=0<b?t.target.elements["induction-time"].value:null,P=null,C=null;if(0<b){var D=t.target.elements["induction-time"];0<t.target.elements["induction-time"].length?z(t.target.elements["induction-time"]).forEach(function(t){t.checked&&(P=t.getAttribute("data-event-reservation"),C=t.getAttribute("data-event-id"))}):(P=D.getAttribute("data-event-reservation"),C=D.getAttribute("data-event-id"))}var Y=new V.a(a,"Online Event reservation",h.clone().format("YYYY-MM-DDTHH:mm:ss"),this.eventTypeId,1,0,w,_,E,"Event reservation notes here",l.clone().format("YYYY-MM-DDTHH:mm:ss"),2,"Online: "+this.wcEventTitle,"KNE Website Online Booking System",this.eventType.trackId),O=new q.a("New reservation event",this.duration,c,l.clone().format("YYYY-MM-DDTHH:mm:ss"),this.eventTypeId,this.eventType.eventTypeName,a,this.eventType.trackId,this.eventHeatTypes),x="Total Qty: "+m+", Qty Adults: "+f+", Qty Cadets: "+v,A=new J.a(null,null,2,0,"TEST Online check for event "+c,p,x,d),B=1;0<this.partyInfo.guests&&(B=this.partyInfo.guests);var N=new W.a(null,null,1,4,i.productId,i.description,d,f,v,i.wcPrice,B,1),S=null;if(0<this.partyInfo.extra_guests){var H=this.partyInfo.extra_guests;S=new W.a(null,null,1,4,this.partyInfo.extra_guest_product_id,"Extra event guests",d,H,0,this.partyInfo.extra_guest_price,1,1)}var L=new U(this.customerId,y,T,k,I),M=$()().format("x"),j=new F.a(M,o,$()(),this.eventTypeId,null,null,null,null,null,null,"open",i.wcName,null);Y.setId(a,this.api).then(function(t){return O.reservationId=t,O.setId(c,s.api)}).then(function(t){return L.setCustomer(s.api)}).then(function(t){return A.customerId=t,A.createCheckOnApi(s.api)}).then(function(t){return A.checkId=t,N.checkId=t,S&&(S.checkId=t),N.createCheckDetailsOnApi(s.api)}).then(function(t){return N.checkDetailsId=t,A.checkDetails[t]=N,S?S.createCheckDetailsOnApi(s.api):null}).then(function(t){return t&&(S.checkDetailsId=t),s.api.base_url+"eventReservationLinks?key="+s.api.api+"&checkId="+A.checkId+"&reservationId="+Y.eventReservationId}).then(function(t){return fetch(t,{method:"POST"})}).then(function(t){if(!t.ok)throw new Error(t.statusText);return t}).then(function(t){return t.json()}).then(function(t){return j.eventReservation=Y,j.eventReservation.event=O,j.eventReservation.checks[A.checkId]=A,j.eventReservationLink=t,j.customer=L,j.check=A,j.checkDetails=N,j.extrasCheckDetails=S,0<b?s.makeInductionReservation(P,C,R,A.customerId):null}).then(function(t){return j.induction=t,(new Q.a).store(j.reservationId,"reservations",j),!0}).then(function(t){var e=o;if(0<b){var n=j.induction,r=$()(n.startTime,"YYYY-MM-DDTHH:mm:ss").format("YYYYMMDDTHHmmss");e=o+":"+m+","+s.inductionInfo.induction_wc_product+":"+s.qtyInduction+":"+n.eventReservationId+":"+n.checks.checkId+":"+r}0<partyInfo.extra_guests&&(e=o+":"+m+","+s.partyInfo.extra_guest_wc_product_id+":"+s.partyInfo.extra_guests);var i=document.location.origin+"/booking-confirmation/?add-to-cart="+e+"&quantity="+m+"&resid="+j.reservationId+"&checkid="+A.checkId+"&start="+l.format("YYYYMMDDTHHmmss")+"&qtyCadets="+v+"&qtyInduction="+b+"&eventResId="+Y.eventReservationId+"&customer="+L.customerId+"&checkdetailsid="+N.checkDetailsId+"&addedtocart="+d+"&partyguests="+s.partyInfo.guests;window.location.href=i}).catch(function(t){console.log(t)})},h.prototype.makeInductionReservation=function(u,l,h,p){return new Promise(function(e,n){var r=this,t=$()(h),i=t.clone().add(this.inductionInfo.duration,"m"),s=$()().format("YYYY-MM-DDTHH:mm:ss"),o=new V.a(u,"Online induction reservation",i.clone().format("YYYY-MM-DDTHH:mm:ss"),this.inductionInfo.event_type_id,1,0,qtyInduction,0,qtyInduction,"Induction notes",t.clone().format("YYYY-MM-DDTHH:mm:ss"),2,"Online: Induction","KNE Website Online Booking System",this.inductionInfo.track),a=new q.a("New induction event",this.inductionInfo.duration,l,t.clone().format("YYYY-MM-DDTHH:mm:ss"),this.inductionInfo.event_type_id,null,u,this.inductionInfo.track),c=new J.a(null,p,2,0,"Induction check for event reservation"+o,0,"Induction check",s),d=new W.a(null,null,1,4,this.inductionInfo.product_id,"Induction",s,0,this.qtyInduction,this.inductionInfo.price,1,1);o.setId(u,this.api).then(function(t){return a.reservationId=t,a.setId(l,r.api)}).then(function(t){return o.event=a,c.createCheckOnApi(r.api)}).then(function(t){return c.checkId=t,o.checks.checkId=c.checkId,o.checks.check=c,d.checkId=t,d.createCheckDetailsOnApi(r.api)}).then(function(t){return d.checkDetailsId=t,o.checks.checkDetails=d,r.api.base_url+"eventReservationLinks?key="+r.api.api+"&checkId="+c.checkId+"&reservationId="+o.eventReservationId}).then(function(t){return fetch(t,{method:"POST"})}).then(function(t){if(!t.ok)throw new Error(t.statusText);return t}).then(function(t){return t.json()}).then(function(t){o.eventReservationLink=t,e(o)}).catch(function(t){n(t)})}.bind(this))};var m=h;function v(t,e,n,r,i,s){this.eventTypeId=t,this.description=e,this.eventTypeName=n,this.onlineProductId=r,this.ptsPerReservation=i,this.trackId=s}v.prototype.getEventTypeById=function(s,o){if(!s)this.eventTypeId;return new Promise(function(e,t){var n=new Q.a,r=n.retrieve("eventType");if(r&&r.items[s]&&!n.expired(r.items[s])){var i=r.items[s];return this.description=i.description,this.eventTypeName=i.eventTypeName,this.onlineProductId=i.onlineProductId,this.trackId=i.trackId,console.log(" event type fetched from storage"),e(r.items[s])}this.getEventTypeFromApi(o).then(function(t){console.log("from api"),n.store(t.eventTypeId,"eventType",t),e(t)})}.bind(this))},v.prototype.getEventTypeFromApi=function(i){return new Promise(function(e,n){var r=this,t=i.base_url+"eventTypes/"+this.eventTypeId+"?key="+i.api;fetch(t).then(function(t){return i.checkResponse(t)}).then(function(t){return i.returnJson(t)}).then(function(t){r.description=t.description,r.eventTypeName=t.eventTypeName,r.onlineProductId=t.onlineProductId,r.trackId=t.trackId,e(t)}).catch(function(t){n(t)})}.bind(this))};var y=v;function g(t,e,n,r,i,s,o){var a=7<arguments.length&&void 0!==arguments[7]?arguments[7]:null;this.productId=t,this.productType=e,this.description=n,this.price1=r,this.price2=i,this.r_Points=s,this.priceCadet=o,this.wcName=a}g.prototype.getProductById=function(s,o){if(!s)this.productId;return new Promise(function(e,t){var n=new Q.a,r=n.retrieve("products");if(r&&r.items[s]&&!n.expired(r.items[s])){var i=r.items[s];return this.productId=i.productId,this.productType=i.productType,this.description=i.description,this.price1=i.price1,this.price2=i.price2,this.r_Points=i.r_Points,this.priceCadet=i.priceCadet,console.log("product fetched from storage"),e(r.items[s])}this.getProductFromApi(o).then(function(t){console.log("from api"),n.store(t.productId,"products",t),e(t)})}.bind(this))},g.prototype.getProductFromApi=function(i){return new Promise(function(n,e){var r=this,t=i.base_url+"products/"+this.productId+"?key="+i.api;fetch(t).then(function(t){return i.checkResponse(t)}).then(function(t){return i.returnJson(t)}).then(function(t){var e=t.products[0];r.productId=e.productId,r.productType=e.productType,r.description=e.description,r.price1=e.price1,r.price2=e.price2,r.r_Points=e.r_Points,r.priceCadet=e.priceCadet,n(e)}).catch(function(t){e(t)})}.bind(this))};var I=g,b=n(5),w=n(13);function E(t){this.gtag=t}E.prototype.bookingStart=function(r,i){return new Promise(function(t,e){var n=this.gtag("event","Booking Start",{event_category:"ecommerce",event_label:i,value:r});console.log("Booking start event triggered"+n),t(!0)}.bind(this))},E.prototype.numbersChosen=function(n,r){return new Promise(function(t,e){this.gtag("event","Numbers Chosen",{event_category:"ecommerce",event_label:r,value:n}),console.log("Numbers chosen event triggered"),t(!0)}.bind(this))},E.prototype.calendarDateChosen=function(n){return new Promise(function(t,e){this.gtag("event","Calendar Date Chosen",{event_category:"ecommerce",event_label:n}),console.log("Calendar date event triggered"),t(!0)}.bind(this))};var _=E;function R(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var P=new _(gtag),C=document.getElementsByName("event_category");function D(t){document.getElementById("choose-event-header").style.display="inline-block";var e=document.getElementsByClassName("event"),n=Array.from(e),r=document.getElementById("booking-choose-event");n.forEach(function(t){t.checked=!1,t.style.display="none";var e=parseInt(t.value,10),n=t.getAttribute("data-product-name");t.addEventListener("change",function(t){P.bookingStart(e,n).then(function(t){r.submit()})})});var i=t,s=document.getElementsByClassName(i);Array.from(s).forEach(function(t){t.style.display="inline-flex"});var o=document.getElementsByClassName("events")[0];Object(w.a)(o,160)}if(Array.from(C).forEach(function(t){t.addEventListener("change",function(t){D(t.target.value)}),t.checked&&D(t.value)}),0<document.getElementsByName("qty_extra").length){var Y=document.getElementById("qty_party_guests"),O=document.getElementsByClassName("party_extra_guests");Y.addEventListener("change",function(t){var e=parseInt(t.target.getAttribute("max"),10);t.target.value>=e?R(O).forEach(function(t){console.log(t),t.disabled=!1}):R(O).forEach(function(t){console.log(t),t.disabled=!0})})}function x(t){var e=document.getElementById("qty_total"),n=parseInt(e.value),r=document.getElementById("qty_cadets"),i=parseInt(r.value),s=parseInt(document.getElementById("qty_induction").value),o=document.getElementById("booking-start-form-submit"),a=null,c=null;0<document.getElementsByClassName("qty-cadet-validation").length&&(a=document.getElementsByClassName("qty-cadet-validation")[0],o.disabled=n<i?(a.style.display="inline-block",e.style.borderColor="#c01349",!0):(a.style.display="none",!(e.style.borderColor="#575756"))),0<document.getElementsByClassName("qty-induction-validation").length&&(c=document.getElementsByClassName("qty-induction-validation")[0],o.disabled=i<s?(c.style.display="inline-block",r.style.borderColor="#c01349",!0):(c.style.display="none",!(r.style.borderColor="#575756")))}if(document.getElementById("qty_total")&&(document.getElementById("qty_total").addEventListener("change",function(t){var e,n,r;n=(e=t).target.getAttribute("data-min-new"),r=null,0<document.getElementsByClassName("qty-total-notice").length&&(r=document.getElementsByClassName("qty-total-notice")[0],e.target.value<n?r.style.display="inline-block":r.style.display="none")}),document.getElementById("qty_total").addEventListener("change",function(t){x(t)})),document.getElementById("qty_cadets")&&document.getElementById("qty_cadets").addEventListener("change",function(t){x(t)}),document.getElementById("qty_induction")&&document.getElementById("qty_induction").addEventListener("change",function(t){x(t)}),document.getElementById("booking-start-form-submit")){var A=document.getElementById("booking-start-form-submit"),B=A.parentNode,N=A.parentNode.elements,S=parseInt(N.prod.value,10),H=parseInt(N.qty_total.value,10);A.addEventListener("click",function(t){t.preventDefault(),P.numbersChosen(H,S).then(function(t){B.submit()})})}function L(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var M=new _(gtag);if("undefined"!=typeof viewType&&"undefined"!=typeof wcProductId&&eventTypeId&&"undefined"!=typeof inductionEventTypeId&&"booking-start"==viewType){var j=new b.a,K=(j.base_url,j.api,j.limit,new y(eventTypeId));K.getEventTypeById(eventTypeId,j).then(function(t){return new I(t.onlineProductId).getProductById(t.onlineProductId,j)}).then(function(t){console.log(t)});var X=new y(inductionEventTypeId),Z=null;X.getEventTypeById(inductionEventTypeId,j).then(function(t){return(Z=new I(t.onlineProductId)).getProductById(t.onlineProductId,j)}).then(function(t){var e=document.getElementsByClassName("induction_cost");Array.from(e).forEach(function(t){t.innerHTML="&pound;"+parseInt(Z.price1,10).toFixed(2)})})}if("undefined"!=typeof wcProductId&&"undefined"!=typeof qtyTotal&&"undefined"!=typeof eventTypeId&&("calendar"==viewType||"day"==viewType)){var tt=new b.a,et=(tt.base_url,tt.api,tt.limit,[]);if(productTimeVariations.length&&productTimeVariations.forEach(function(t){et.push({id:t.product_id,wcProductId:t.wc_product_id,name:t.name,price:t.price,regularPrice:t.regular_price,onSale:t.on_sale,startTimes:t.product_start_times,includedPeriods:t.included_periods,other_product_ids:t.other_product_ids})}),0<qtyInduction){var nt=new y(inductionInfo.event_type_id),rt=null;nt.getEventTypeById(inductionInfo.event_type_id,tt).then(function(t){return(rt=new I(t.onlineProductId)).getProductById(t.onlineProductId,tt)}).then(function(t){inductionInfo.price=parseInt(rt.price1).toFixed(2)})}var it=new m(wcProductId,wcEventTitle,qtyTotal,qtyCadets,qtyInduction,eventTypeId,siblingEventTypeIds,eventDayInfo,startDate,endDate,eventDuration,inductionInfo,currentUser,customerId,partyInfo,null,singleReservation,setTimesOnly,scheduleSettings,tt,newReservations,myEvents,wcPrice,wcRegularPrice,onSale);if("day"==viewType){if(document.getElementById("schedule")){var st=document.getElementById("schedule");it.schedule=new u(st,startDate,scheduleSettings.start,scheduleSettings.end,scheduleSettings.period,tracks,tt),it.schedule.startLoading(0),it.getEventTypes(tracks.main).then(function(t){return it.getProducts(productId,et)}).then(function(t){return it.product.wcName=wcEventTitle,it.constructEventReservations()}).then(function(t){return it.getMyEventInfo()}).then(function(t){it.constructTimeslots(),it.fillTimeslots();var e=0;newReservations&&(e=it.drawAddButtons());var n=it.drawEvents();if(e+n.available<1&&(it.schedule.trackWrappers.mainTrack.classList.add("no-availability"),n.unavailable<1)){var r=document.createElement("p"),i=document.createTextNode("No availability on this date");r.appendChild(i),it.schedule.trackWrappers.mainTrack.appendChild(r)}it.schedule.stopLoading(0),console.log(it),0<tracks.other_tracks.length&&it.schedule.renderOtherTracks(myEvents),"undefined"!=typeof eventReservationIdFromURL&&0<eventReservationIdFromURL&&(console.log(eventReservationIdFromURL),it.showEventDetails({target:document.getElementById(eventReservationIdFromURL)},null,eventReservationIdFromURL,isFamilyEvent))}).catch(function(t){if(console.log(t),-1<t.message.indexOf("Failed to fetch")){var e=document.createElement("div"),n=document.createElement("p");n.innerHTML='We\'re having some problems communicating with our booking system, sorry! Please try again later, or call us on <a href="tel:01915214050">0191 521 4050</a>.';var r=document.createElement("a"),i=document.createTextNode("Return to homepage");r.href="/",r.appendChild(i),e.appendChild(n),e.appendChild(r),Object(G.a)(!0,!1,e)}})}}else if(it.getEventTypes(tracks.main).then(function(t){return it.getProducts(productId,et)}).then(function(t){return it.constructEventReservations()}).then(function(t){it.constructTimeslots(),it.fillTimeslots(),it.checkAvailability(),console.log(it)}).catch(function(t){console.log(t)}),0<document.getElementsByClassName("calendar").length)L(document.getElementsByClassName("day")).forEach(function(t){var n=t.getAttribute("data-date");L(t.children).forEach(function(t){if("A"==t.tagName){var e=t.href;t.addEventListener("click",function(t){t.preventDefault(),M.calendarDateChosen(n).then(function(t){window.location.href=e})})}})})}}});
//# sourceMappingURL=booking.js.map