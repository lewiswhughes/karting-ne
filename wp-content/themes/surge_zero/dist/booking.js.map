{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/scripts/booking/scheduleOtherTracks.js","webpack:///./src/scripts/booking/schedule.js","webpack:///./src/scripts/users/customer.js","webpack:///./src/scripts/booking/events.js","webpack:///./src/scripts/booking/eventType.js","webpack:///./src/scripts/booking/Product.js","webpack:///./src/scripts/analytics/analyticsEvents.js","webpack:///./src/scripts/ui/bookingForms.js","webpack:///./src/booking.js"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","2","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","OtherTrack","trackId","trackInfo","targetEl","this","eventTypes","eventReservations","timeslots","getEventTypes","api","Promise","resolve","reject","_this","eventTypesQueryString","base_url","limit","fetch","then","response","checkResponse","returnJson","forEach","eventType","eventTypeId","catch","err","getEventReservations","startDate","endDate","_this2","eventResQueryString","eventReservation","eventReservationId","drawEvents","scheduleSettings","myEvents","scheduleEl","eventResKeys","keys","_i","eventResKey","eventRes","startTime","moment","format","endTime","parseInt","start","end","eventEl","document","createElement","addColumnChildClass","id","classList","add","style","cssText","map","indexOf","myEventEl","createParagraph","title","eventTitle","createHeader","cartLink","href","target","appendChild","drawSelectHeader","tracks","selectEl","track_index","setAttribute","track_info","track","shown_tracks","Array","from","other_tracks","main","track_id","optionEl","optionText","createTextNode","track_name","selected","drawClosed","console","log","getElementById","day","toLowerCase","open","replace","close","closed","Schedule","arguments","undefined","date","period","trackWrappers","colWidth","modifyStartTime","eventStartTime","modifyRowTemplate","modifyEndTime","eventEndTime","startMoment","endMoment","thisMoment","clone","templateString","time","timeDisplay","getElementsByClassName","timeElCont","timeEl","timeText","gridRow","gridTemplateRows","renderOtherTracks","setGridColumnsTemplate","startLoading","addEventListener","changeTrack","stopLoading","error","e","currentTrack","getAttribute","newTrackId","currIndex","_toConsumableArray","childEl","remove","gridTemplateColsString","gridTemplateColumns","trackWrapper","drawTrackWrapper","addSpinner","mainTrackWrapper","removeSpinner","trackWrapperEl","mainTrack","Customer","customerId","email","firstName","lastName","telephone","checkCustomerExists","checkCustomerString","ok","Error","statusText","json","customers","createCustomerOnApi","now","postCustomerString","method","newCustomerId","setCustomer","Events","wcProductId","wcEventTitle","qtyTotal","qtyCadets","qtyInduction","siblingEventTypeIds","eventDayInfo","duration","inductionInfo","currentUser","partyInfo","schedule","singleReservation","setTimesOnly","apiSettings","newReservations","wcPrice","wcRegularPrice","onSale","bookingQty","otherEventTypeIds","trackEventTypes","otherTracks","eventHeatTypes","product","productVariations","maxRacersFromHeatTypes","cadets","total","trackIds","eventTypeData","eventHeatTypesQueryString","eventHeatType","racersPerHeat","cadetsPerHeat","getProducts","productId","otherProducts","Product","getProductById","otherProductIds","startTimes","productInfo","_this3","includedPeriods","wcName","parseFloat","price","toFixed","regularPrice","other_product_ids","constructEventReservations","_this4","eventReservationIds","checkIds","checks","resultResIds","getEvents","getEventReservationLinks","resultCheckIds","getChecks","checksData","check","checkId","checkDetails","getCheckDetails","checkDetailsData","checkDetailId","resKeys","resKey","checkKeys","_i2","checkKey","_this5","allEventTypeIds","concat","hidden","status","EventReservation","description","minNoOfAdultsPerBooking","minNoOfCadetsPerBooking","noOfCadetRacers","noOfRacers","noOfTotalRacers","notes","subject","externalSystemId","typeId","_this6","eventsQueryString","eventsData","event","Event","eventDesc","eventDuration","eventId","eventScheduledTime","eventTypeName","reservationId","trackNo","_this7","eventResLinksQueryString","eventResLinksData","eventReservationLink","checksQueryString","checkDetailsQueryString","getMyEventInfo","_this8","myEventsKeys","getMyEventInfoString","constructTimeslots","startingMoment","thisDate","startTimeMoment","endTimeMoment","times","timeSlotIndex","checkNotTooSoon","subtract","dayLimitations","saturday","maxGroupSize","sunday","default","limitations","checkMinTime","checkTimeOneDay","allowedStartTime","hour","allowedEndTime","checkTime","setMaxParticipants","maxParticipants","max","fillTimeslots","_i3","dateIndex","timeslotIndex","overlapsEventsInCart","overlaps","myEventResKey","myEventRes","myEventResStart","myEventResEnd","isAfter","isBefore","isSameOrBefore","info","availableEvents","unavailableEvents","_i4","currentParticipants","productNameText","getProductVariation","getCurrentParticipants","productName","productNameTextNode","remainingPlaceInfo","remainingPlaceText","showEventDetails","available","unavailable","drawAddButtons","dayIndex","dayInfo","drawAddButton","timeslot","_this9","addButton","dateTimeString","toCurrency","addButtonText","innerHTML","start_times","custom_start_times","start_time","timeslotKeys","_i5","_i6","prospective","passedEventResId","isFamilyEvent","inductionPrice","newReservationForm","expand","reservationForm","_this10","autoLoadForm","ReservationForm","onsubmit","makeReservation","addFormElements","loadInductionStartTimes","inductionsInput","inductionSelectEl","display","inductionTimesEl","getElementsByTagName","events_toConsumableArray","label","parentNode","removeChild","input","onQuantityChange","checkAvailability","availability","checkAvailabilityByDate","dateElement","freeEvent","availableSlot","_i7","_i8","isValidStartTime","eventDay","eventDateIndex","scheduleStartTime","scheduleEndTime","customStartTimes","found","isSame","isVariationPeriod","valid","included_times","timeSet","end_time","isSameOrAfter","checkSchedule","productIds","foundProductId","getInductionStartTimes","index","checkTimeAvailable","event_type_id","inductionEventResId","inductionEventId","addInductionTime","noInductionsAvailable","possibleInductionTimes","today","inductionDuration","trackOpeningDetails","opening_hours","trackOpen","inductionStartTimes","event_day_info","_this11","eventTypeIds","resEventReservations","_this12","events","res","_this13","preventDefault","submitButton","disabled","messageBox","messagePara","showOverlay","elements","startValue","subtotal","qty","qtyAdults","split","minutes","Date","setTime","getTime","expires","toGMTString","cookie","createCookie","inductionTime","inductionTimeElements","checked","newEventReservation","newEvent","checkNotes","newCheck","Check","rPoints","guests","newCheckDetails","CheckDetails","extrasCheckDetails","extra_guests","extrasQty","extra_guest_product_id","extra_guest_price","newCustomer","newReservation","Reservation","setId","newEventReservationId","newEventId","createCheckOnApi","newCheckId","createCheckDetailsOnApi","newCheckDetailsId","checkDetailsId","extrasCheckDetailsId","postEventResLinkString","eventResLinkId","customer","makeInductionReservation","inductionDetails","induction","Storage","store","addToCartString","formattedStart","induction_wc_product","extra_guest_wc_product_id","redirectUrl","location","origin","_this14","inductionStart","inductionEnd","inductionEventRes","inductionEvent","inductionCheck","inductionCheckDetails","product_id","eventResId","inductionCheckId","EventType","onlineProductId","ptsPerReservation","getEventTypeById","storage","eventTypeStorage","retrieve","items","expired","getEventTypeFromApi","productType","price1","price2","r_Points","priceCadet","productStorage","getProductFromApi","productQueryString","products","AnalyticsEvents","gtag","bookingStart","event_category","event_label","numbersChosen","totalParticipants","calendarDateChosen","analytics","eventCategoryInputEls","getElementsByName","showCategoryEvents","trgtClass","productInputEls","productInputs","bookingStartForm","submit","category","productCatInputEls","eventsCont","scrollTo","qtyInput","qtyExtraEls","bookingForms_toConsumableArray","element","qtyValidations","totalQtyField","totalQty","cadetQtyField","cadetQty","inductionQty","submitBtn","cadetValidationMsg","inductionValidationMsg","borderColor","minNumberNewRes","qtyTotalNotice","bookingStartFormSubmit","formElements","prod","qty_total","viewType","inductionEventTypeId","Api","inductionEventType","inductionProduct","inductionCostPlaceholdersEls","productTimeVariations","timeVariation","wc_product_id","regular_price","on_sale","product_start_times","included_periods","EventsWrapper","totalAddButtons","totalAvailableEvents","noAvailabilityNotice","noAvailabilityText","eventReservationIdFromURL","message","homeLink","homeLinkText","booking_toConsumableArray","dayEl","children","child","tagName"],"mappings":"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","file":"booking.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t2: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([147,1,0]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import moment from 'moment';\nimport { createHeader, createParagraph } from '../utilities/elements.js';\n\nfunction OtherTrack( trackId, trackInfo, targetEl ){\n\n  this.trackId = trackId;\n  this.trackInfo = trackInfo;\n  this.targetEl = targetEl;\n\n  this.eventTypes = [];\n  this.eventReservations = {};\n  this.timeslots = [];\n\n}\n\nOtherTrack.prototype.getEventTypes = function ( api ) {\n  return new Promise( function( resolve, reject ){\n\n    let eventTypesQueryString = api.base_url + 'eventTypes?key=' + api.api + '&limit=' + api.limit + '&where={\"deleted\":\"false\", \"trackId\":' + this.trackId + '}';\n\n    fetch( eventTypesQueryString )\n      .then( response => api.checkResponse(response) )\n      .then( response => api.returnJson(response) )\n      .then( eventTypes => {\n        eventTypes.forEach( function( eventType ){\n          this.eventTypes.push( eventType.eventTypeId )\n        }.bind(this))\n        resolve( eventTypes )\n      })\n      .catch( err => {\n        reject( err );\n      })\n\n  }.bind(this))\n};\n\nOtherTrack.prototype.getEventReservations = function ( startDate, endDate, api ) {\n  return new Promise(function(resolve, reject) {\n\n    let eventResQueryString = api.base_url + 'eventReservations?key=' + api.api + '&limit=' + api.limit +\n    '&where={\"status\":{\"$in\":[0,1,2,3,6]}, \"deleted\":\"false\", \"startTime\": {\"$gte\":\"' + startDate + 'T00:00:00\", \"$lte\":\"' + endDate + 'T23:59:00\"}, \"eventTypeId\":{\"in\":[' + this.eventTypes + ']}}';\n\n    fetch( eventResQueryString )\n      .then( response => api.checkResponse(response) )\n      .then( response => api.returnJson(response) )\n      .then( eventReservations => {\n        eventReservations.forEach( function( eventReservation ){\n          this.eventReservations[eventReservation.eventReservationId] = eventReservation;\n        }.bind(this))\n        resolve( eventReservations )\n      })\n      .catch( err => {\n        reject( err );\n      })\n\n  }.bind(this));\n};\n\nOtherTrack.prototype.drawEvents = function ( scheduleSettings, myEvents ) {\n\n  //schedule\n  let scheduleEl = this.targetEl;\n  //fill for events\n  if(this.eventReservations){\n    let eventResKeys = Object.keys(this.eventReservations);\n    for (const eventResKey of eventResKeys) {\n      let eventRes = this.eventReservations[eventResKey];\n      let startTime = moment(eventRes.startTime).format('kmm');\n      let endTime = moment(eventRes.endTime).format('kmm');\n      if( parseInt(startTime, 10) < parseInt(scheduleSettings.start, 10) && parseInt(endTime, 10) > parseInt(scheduleSettings.start, 10) ){\n        //too early, but finishes after opening - change start to earliest of main schedule\n        startTime =  scheduleSettings.start;\n      }\n      if( parseInt(endTime, 10) > parseInt(scheduleSettings.end, 10) && parseInt(startTime, 10) < parseInt(scheduleSettings.end, 10)){\n        //too late, but starts before close - change start to earliest of main schedule\n        endTime =  scheduleSettings.end;\n      }\n\n      //create element if within scheudle hours\n      if ( parseInt( startTime, 10 ) >= parseInt( scheduleSettings.start, 10 ) && parseInt( endTime, 10 ) <= parseInt( scheduleSettings.end, 10 ) ) {\n        let eventEl = document.createElement('article');\n        this.addColumnChildClass( eventEl );\n        eventEl.id = eventRes.eventReservationId;\n        eventEl.classList.add('schedule-event');\n        eventEl.style.cssText = 'grid-row: row' + startTime + ' / row' + endTime + '; grid-column: colEvent' + this.trackId + ' / span 1;';\n\n        let myEventsKeys = Object.keys(myEvents).map( key => parseInt( key, 10 ) );\n        if( myEventsKeys.indexOf( eventRes.eventReservationId ) > -1 ){\n          let myEventEl = createParagraph( myEvents[eventRes.eventReservationId].title );\n          let eventTitle = createHeader( 'h4', 'My Event' );\n          let cartLink = document.createElement('a');\n          cartLink.href = '/cart';\n          cartLink.target = '_self';\n          eventEl.appendChild( eventTitle );\n          eventEl.appendChild( myEventEl );\n          eventEl.appendChild( cartLink );\n          eventEl.classList.add('my-event');\n        } else {\n          eventEl.classList.add('hidden');\n        }\n\n        scheduleEl.appendChild(eventEl);\n      }\n    }\n  }\n};\n\nOtherTrack.prototype.drawSelectHeader = function ( tracks ) {\n  //draws select elements for track headers - change event bound in bookings.js\n  let selectEl = document.createElement('select');\n  selectEl.setAttribute( 'data-current', this.trackId );\n  this.addColumnChildClass( selectEl );\n  selectEl.style.cssText = 'grid-row: 1 / span 1; grid-column: colEvent' + this.trackId + ' / span 1';\n  //draw options\n  for ( const track_index in tracks.track_info ){\n    let track = tracks.track_info[track_index];\n    //create array of shown tracks\n    let shown_tracks = Array.from(tracks.other_tracks);\n    shown_tracks.push( tracks.main );\n    //if not main and not in other_tracks\n    if ( shown_tracks.indexOf( parseInt(track.track_id, 10) ) < 0 || parseInt(track.track_id, 10) === this.trackId ) {\n      let optionEl = document.createElement('option');\n      let optionText = document.createTextNode(track.track_name);\n      optionEl.value = track.track_id;\n      //if current track select\n      if( parseInt(track.track_id, 10) === this.trackId ){\n        optionEl.selected = true;\n      }\n      optionEl.appendChild( optionText );\n      selectEl.appendChild( optionEl );\n    }\n  }\n  this.targetEl.appendChild( selectEl );\n  return selectEl; //return for binding event\n};\n\nOtherTrack.prototype.drawClosed = function ( startDate, trackInfo, scheduleSettings ) {\n  console.log(startDate);\n  //schedule\n  let scheduleEl = document.getElementById('schedule');\n  let day = moment(startDate).format('dddd').toLowerCase();\n  let open = trackInfo['opening_hours'][day]['open'].replace(':','');\n  let close = trackInfo['opening_hours'][day]['close'].replace(':','');\n  let closed = trackInfo['opening_hours'][day]['closed'];\n  console.log(trackInfo, day, closed);\n  //if closed\n  if( closed ){\n    let eventEl = document.createElement('article');\n    this.addColumnChildClass( eventEl );\n    eventEl.classList.add('schedule-event');\n    eventEl.classList.add('closed');\n    eventEl.style.cssText = 'grid-row: row' + parseInt(scheduleSettings.start, 10) + ' / row' + parseInt(scheduleSettings.end, 10) + '; grid-column: colEvent' + this.trackId + ' / span 1;';\n    scheduleEl.appendChild(eventEl);\n  } else {\n    //open - if open later than main track start\n    if( parseInt( open, 10 ) > parseInt( scheduleSettings.start, 10 ) ){\n      let eventEl = document.createElement('article');\n      this.addColumnChildClass( eventEl );\n      eventEl.classList.add('schedule-event');\n      eventEl.classList.add('closed');\n      eventEl.style.cssText = 'grid-row: row' + parseInt(scheduleSettings.start, 10) + ' / row' + parseInt(open, 10) + '; grid-column: colEvent' + this.trackId + ' / span 1;';\n      scheduleEl.appendChild(eventEl);\n    }\n    //close - if close earlier than main track end\n    if( parseInt( close, 10 ) < parseInt( scheduleSettings.end, 10 ) ){\n      let eventEl = document.createElement('article');\n      this.addColumnChildClass( eventEl );\n      eventEl.classList.add('schedule-event');\n      eventEl.classList.add('closed');\n      eventEl.style.cssText = 'grid-row: row' + parseInt(close, 10) + ' / row' + parseInt(scheduleSettings.end, 10) + '; grid-column: colEvent' + this.trackId + ' / span 1;';\n      scheduleEl.appendChild(eventEl);\n    }\n  }\n};\n\nOtherTrack.prototype.addColumnChildClass = function ( targetEl ) {\n  targetEl.classList.add('track-' + this.trackId + '-item');\n}\n\nexport default OtherTrack;\n","import OtherTrack from './scheduleOtherTracks.js';\nimport moment from 'moment';\nimport { addSpinner, removeSpinner } from '../utilities/spinner.js'; //ui js\n\nfunction Schedule ( targetEl = null, date, start = 800, end = 2200, period = 30, tracks, api ){\n\n  this.targetEl = targetEl;\n  this.date = date;\n  this.start = start;\n  this.end = end;\n  this.period = period;\n  this.tracks = tracks;\n  this.api = api;\n\n  this.trackWrappers = {};\n  this.colWidth = 'minmax(14rem, 24rem)';\n\n}\n\nSchedule.prototype.modifyStartTime = function ( eventStartTime ) {\n  this.start = eventStartTime;\n  this.modifyRowTemplate();\n};\n\nSchedule.prototype.modifyEndTime = function ( eventEndTime ) {\n  this.end = eventEndTime;\n  this.modifyRowTemplate();\n};\n\nSchedule.prototype.modifyRowTemplate = function () {\n  let startMoment = moment( this.start, 'Hmm');\n  let endMoment = moment( this.end, 'Hmm');\n  let thisMoment = startMoment.clone();\n  let templateString = '[trackname] minmax(2rem, 1fr)';\n  while( thisMoment <= endMoment ){\n    //modify template string\n    let time = thisMoment.format('kmm');\n    let timeDisplay = thisMoment.format('H:mm');\n    templateString += ' [row'+time+'] minmax(2rem, 1fr)';\n    //append time element if doesn't exist\n    if( document.getElementsByClassName( time ).length < 1 ){\n      let timeElCont = document.createElement('div');\n      let timeEl = document.createElement('h4');\n      let timeText = document.createTextNode( timeDisplay );\n      timeElCont.classList.add('time');\n      //set hour class\n      if( thisMoment.format('m') === 0 ){\n        timeElCont.classList.add('hour');\n      }\n      //grid row\n      timeElCont.style.gridRow = 'row' + time + ' / span 1';\n      timeEl.appendChild( timeText );\n      timeElCont.appendChild( timeEl )\n      this.targetEl.appendChild( timeElCont );\n    }\n    thisMoment.add( this.period, 'm' );\n  }\n  this.targetEl.style.gridTemplateRows = templateString;\n};\n\nSchedule.prototype.renderOtherTracks = function ( myEvents ) {\n  return new Promise( function( resolve, reject ){\n\n    this.setGridColumnsTemplate();\n\n    this.tracks.other_tracks.forEach( function( trackId ){\n      //create object\n      let track = new OtherTrack( trackId, this.tracks.track_info[trackId], this.targetEl );\n      //start loading\n      this.startLoading( trackId );\n\n      track.getEventTypes( this.api )\n        .then( eventTypes => {\n          return track.getEventReservations( this.date, this.date, this.api )\n        })\n        .then( eventReservations => {\n          let selectHeader = track.drawSelectHeader( this.tracks );\n          //bind loading to select header\n          selectHeader.addEventListener( 'change', this.changeTrack.bind(this) );\n          track.drawEvents( scheduleSettings, myEvents );\n          console.log(this);\n          track.drawClosed( this.date, this.tracks.track_info[trackId], scheduleSettings);\n          this.stopLoading( trackId );\n        })\n        .catch( err => {\n          console.error( err );\n        })\n\n    }.bind(this))\n\n  }.bind(this))\n};\n\nSchedule.prototype.changeTrack = function (e) {\n  let selectEl = e.target;\n  let currentTrack = parseInt(selectEl.getAttribute( 'data-current' ), 10);\n  let newTrackId = parseInt(e.target.value, 10);\n  selectEl.setAttribute('data-current', newTrackId);\n  //replace in array\n  let currIndex = this.tracks.other_tracks.indexOf( currentTrack );\n  this.tracks.other_tracks[ currIndex ] = newTrackId;\n  //remove old children\n  let currentTrackChildren = document.getElementsByClassName('track-' + currentTrack + '-item');\n  [...currentTrackChildren].forEach( function( childEl ){\n    childEl.remove();\n  })\n  //call render again\n  this.renderOtherTracks();\n}\n\nSchedule.prototype.setGridColumnsTemplate = function () {\n  let gridTemplateColsString = '[times] 3.5rem [main] ' + this.colWidth + ' ';\n  //loop through other tracks\n  this.tracks.other_tracks.forEach( function( trackId ){\n    gridTemplateColsString += '[colEvent' + trackId + '] ' + this.colWidth + ' ';\n  }.bind(this))\n  this.targetEl.style.gridTemplateColumns = gridTemplateColsString;\n}\n\nSchedule.prototype.startLoading = function ( trackId ) {\n  if ( trackId == 0 ){\n    //main track\n    let trackWrapper = this.drawTrackWrapper(0);\n    addSpinner( trackWrapper );\n  } else {\n    let trackWrapper = this.drawTrackWrapper( trackId );\n    addSpinner( trackWrapper );\n  }\n};\n\nSchedule.prototype.stopLoading = function ( trackId ) {\n  if ( trackId == 0 ){\n    //main\n    let mainTrackWrapper = document.getElementsByClassName('main-track')[0];\n    removeSpinner( mainTrackWrapper );\n  } else {\n    let trackWrapper = document.getElementsByClassName('track-' + trackId)[0];\n    removeSpinner( trackWrapper );\n  }\n};\n\nSchedule.prototype.drawTrackWrapper = function ( trackId ) {\n  let trackWrapperEl = document.createElement('div');\n  trackWrapperEl.classList.add('track-wrapper');\n  //if trackId = 0 main track\n  if( trackId == 0){\n    trackWrapperEl.style.cssText = 'grid-column: main / span 1; grid-row: 2 / -1';\n    trackWrapperEl.classList.add('main-track');\n    this.trackWrappers.mainTrack = trackWrapperEl;\n  } else {\n    trackWrapperEl.style.cssText = 'grid-column: colEvent' + trackId + ' / span 1; grid-row: 2 / -1';\n    trackWrapperEl.classList.add('track-' + trackId);\n    trackWrapperEl.classList.add('track-' + trackId + '-item');\n    this.trackWrappers['track-' + trackId] = trackWrapperEl;\n  }\n\n  this.targetEl.appendChild( trackWrapperEl );\n  return trackWrapperEl;\n};\n\n\n\nexport default Schedule;\n","import moment from 'moment';\n\nfunction Customer ( customerId, email, firstName, lastName, telephone ) {\n\n  this.customerId = customerId;\n  this.email = email;\n  this.firstName = firstName;\n  this.lastName = lastName;\n  this.telephone = telephone || null;\n\n}\n\nCustomer.prototype.checkCustomerExists = function (api) {\n  return new Promise( function( resolve, reject ){\n\n    let checkCustomerString = api.base_url + 'customers?key=' + api.api + '&select=customerId&where={\"email\":\"' + this.email + '\"}';\n\n    fetch( checkCustomerString )\n      .then( response => {\n        if( !response.ok ){\n          throw Error(response.statusText);\n        }\n        return response;\n      })\n      .then( response =>\n        response.json()\n      )\n      .then( customers => {\n        if (customers.length) {\n          resolve(customers[0].customerId) //should only ever be 1 returned!\n        } else {\n          resolve(false)\n        }\n      })\n      .catch( err => {\n        reject(err);\n      })\n\n  }.bind(this))\n}\n\nCustomer.prototype.createCustomerOnApi = function (api) {\n  return new Promise( function( resolve, reject) {\n\n    let now = moment().format('YYYY-MM-DDTHH:mm:ss');\n    let postCustomerString = api.base_url + 'customers?key=' + api.api +\n      '&accountCreated=' + now +\n      '&email=' + this.email +\n      '&firstname=' + this.firstName +\n      '&lastname=' + this.lastName +\n      '&phoneNumber=' + this.telephone;\n\n    fetch( postCustomerString, {method: 'POST'})\n      .then( response => {\n        if( !response.ok ){\n          throw Error(response.statusText);\n        }\n        return response;\n      })\n      .then( response =>\n        response.json()\n      )\n      .then( newCustomerId => {\n        resolve(newCustomerId)\n      })\n      .catch( err => {\n        reject(err);\n      })\n\n  }.bind(this))\n}\n\nCustomer.prototype.setCustomer = function(api) {\n  return new Promise( function (resolve, reject) {\n\n    if(this.customerId){\n      resolve(this.customerId);\n    } else {\n      //check user does not exist\n      this.checkCustomerExists(api)\n        .then( customerId => {\n          if(customerId){\n            return customerId;\n          } else{\n            return this.createCustomerOnApi(api)\n          }\n        })\n        .then( customerId => {\n          this.customerId = customerId;\n          resolve(customerId)\n        })\n    }\n  }.bind(this))\n}\n\n\nexport default Customer;\n","import Event from './event.js';\nimport EventReservation from './eventReservation.js';\nimport Product from './product.js';\nimport Reservation from './reservation.js';\nimport Check from './check.js';\nimport CheckDetails from './checkDetails.js';\nimport Schedule from './schedule.js';\nimport Customer from '../users/customer.js';\nimport moment from 'moment';\nimport ReservationForm from './reservationForm.js';\nimport expand from '../utilities/expand.js';\nimport {createLink} from '../utilities/elements.js';\nimport Storage from '../utilities/storage.js';\nimport {showOverlay, removeOverlay} from '../utilities/overlay.js';\nimport { toCurrency } from '../utilities/numberFormats.js';\nimport { addSpinner } from '../utilities/spinner.js';\n\nfunction createCookie(name,value,minutes) {\n  if (minutes) {\n      var date = new Date();\n      date.setTime(date.getTime()+(minutes*60*1000));\n      var expires = \"; expires=\"+date.toGMTString();\n  } else {\n      var expires = \"\";\n  }\n  document.cookie = name+\"=\"+value+expires+\"; path=/\";\n}\n\nfunction Events (wcProductId, wcEventTitle, qtyTotal, qtyCadets, qtyInduction, eventTypeId, siblingEventTypeIds, eventDayInfo, startDate, endDate, duration, inductionInfo, currentUser, customerId, partyInfo, schedule, singleReservation, setTimesOnly, scheduleSettings, apiSettings, newReservations, myEvents, wcPrice, wcRegularPrice, onSale) {\n\n  this.wcProductId = wcProductId;\n  this.wcEventTitle = wcEventTitle;\n  this.bookingQty = qtyTotal;\n  this.qtyCadets = qtyCadets;\n  this.qtyInduction = qtyInduction;\n  this.eventTypeId = eventTypeId;\n  this.siblingEventTypeIds = siblingEventTypeIds.map( eventTypeId => parseInt( eventTypeId, 10) );\n  this.eventDayInfo = eventDayInfo;\n  this.startDate = startDate;\n  this.endDate = endDate;\n  this.duration = duration;\n  this.inductionInfo = inductionInfo;\n  this.currentUser = currentUser;\n  this.customerId = customerId;\n  this.partyInfo = partyInfo;\n  this.singleReservation = singleReservation;\n  this.setTimesOnly = setTimesOnly;\n  this.schedule = schedule;\n  this.scheduleSettings = scheduleSettings;\n  this.api = apiSettings;\n  this.newReservations = newReservations;\n  this.myEvents = myEvents;\n  this.wcPrice = wcPrice;\n  this.wcRegularPrice = wcRegularPrice;\n  this.onSale = onSale;\n\n  this.eventReservations = {};\n  this.otherEventTypeIds = {\n    trackEventTypes: [],\n    otherTracks: {}\n  };\n  this.eventType = {};\n  this.eventHeatTypes = [];\n  this.product = {};\n  this.productVariations = {};\n\n  this.maxRacersFromHeatTypes = {\n    cadets: null,\n    total: null //number fo adults can be wroked out from these two numbers\n  };\n  this.timeslots = [];\n\n}\n\nEvents.prototype.getEventTypes = function ( trackIds ) {\n  return new Promise( function( resolve, reject ){\n\n    let api = this.api;\n\n    let productId = null;\n\n    let eventTypesQueryString = api.base_url + 'eventTypes?key=' + api.api + '&limit=' + api.limit + '&where={\"deleted\":\"false\", \"trackId\":{\"in\":[' +\n    trackIds + ']}}';\n\n    fetch( eventTypesQueryString )\n      .then( response => api.checkResponse(response) )\n      .then( response => api.returnJson(response) )\n      .then( eventTypeData => {\n        eventTypeData.forEach( function (eventType) {\n          //add eventType details to object if booking event\n          if (eventType.eventTypeId == this.eventTypeId) {\n            this.eventType = eventType;\n            // productId = eventType.onlineProductId;\n          } else {\n            //construct track event types array\n            this.otherEventTypeIds.trackEventTypes.push(eventType.eventTypeId)\n          }\n        }.bind(this))\n        //fetch event heat types\n        let eventHeatTypesQueryString = api.base_url + 'eventHeatTypes?key=' + api.api + '&limit=' + api.limit + '&where={\"eventTypeId\": ' + this.eventTypeId + '}';\n        // console.log(eventHeatTypesQueryString);\n        return eventHeatTypesQueryString;\n      })\n      .then( eventHeatTypesQueryString =>\n        fetch( eventHeatTypesQueryString )\n      )\n      .then( response => api.checkResponse(response) )\n      .then( response => api.returnJson(response) )\n      .then( eventHeatTypes => {\n        eventHeatTypes.forEach( function( eventHeatType ){\n          //check if less than max racers - get smallest number of max racers in heat type\n          if (eventHeatType.racersPerHeat < this.maxRacersFromHeatTypes.total || !this.maxRacersFromHeatTypes.total ) {\n            this.maxRacersFromHeatTypes.total = eventHeatType.racersPerHeat;\n          }\n          if (eventHeatType.cadetsPerHeat < this.maxRacersFromHeatTypes.cadets || !this.maxRacersFromHeatTypes.cadets ) {\n            this.maxRacersFromHeatTypes.cadets = eventHeatType.cadetsPerHeat;\n          }\n          //push to events wrapper\n          this.eventHeatTypes.push(eventHeatType);\n        }.bind(this))\n        resolve( productId );\n      })\n      .catch( err => {\n        reject( err )\n      })\n  }.bind(this))\n}\n\nEvents.prototype.getProducts = function ( productId, otherProducts ) {\n  return new Promise( function ( resolve, reject ){\n      let api = this.api;\n      //get and set main product\n      if(productId){ //will be null on other tracks\n        let product = new Product( productId );\n        product.getProductById( productId, api )\n          .then( product => {\n            //set as product on events wrapper\n            this.product = product;\n            this.product.otherProductIds = otherProductIds;\n            //add product to variations\n            this.productVariations[product.productId] = {\n              product: product,\n              startTimes: this.eventDayInfo\n            }\n            this.productVariations[product.productId].product.otherProductIds = otherProductIds;\n            this.productVariations[product.productId].product.wcPrice = this.wcPrice;\n            this.productVariations[product.productId].product.wcRegularPrice = this.wcRegularPrice;\n            this.productVariations[product.productId].product.onSale = this.onSale;\n          })\n      }\n\n      //get and set other Porudct info\n      if ( otherProducts.length ){\n        otherProducts.forEach( function( productInfo ){\n          let otherProduct = new Product( productInfo.id );\n          otherProduct.getProductById( productInfo.id, api )\n            .then( product => {\n              //add product to variations\n              this.productVariations[product.productId] = {\n                product: product,\n                startTimes: productInfo.startTimes,\n                includedPeriods: productInfo.includedPeriods,\n                wcProductId: productInfo.wcProductId\n              }\n              //add wc name\n              this.productVariations[product.productId].product.wcName = productInfo.name;\n              this.productVariations[product.productId].product.wcName = productInfo.name;\n              this.productVariations[product.productId].product.wcPrice = parseFloat(productInfo.price, 10).toFixed(2);\n              this.productVariations[product.productId].product.wcRegularPrice = parseFloat(productInfo.regularPrice, 10).toFixed(2);\n              this.productVariations[product.productId].product.onSale = productInfo.onSale;\n              this.productVariations[product.productId].product.otherProductIds = productInfo.other_product_ids;\n            })\n        }.bind(this))\n      }\n\n      resolve(true);\n\n  }.bind(this))\n}\n\nEvents.prototype.constructEventReservations = function() {\n  return new Promise( function( resolve, reject ){\n\n    let eventReservationIds = null;\n    let checkIds = null;\n    let checks = {}\n\n    this.getEventReservations()\n      .then( resultResIds => {\n        if(resultResIds.length){\n          eventReservationIds = resultResIds;\n          return this.getEvents( eventReservationIds );\n        } else {\n          throw new Error('Soooorry buddy, no events today');\n        }\n      })\n      .then( result => {\n        return this.getEventReservationLinks( eventReservationIds );\n      })\n      .then( resultCheckIds => {\n        checkIds = resultCheckIds;\n        return this.getChecks( checkIds )\n      })\n      .then( checksData => {\n        //create checks object\n        checksData.checks.forEach( function(check) { // checks are returned as object containing array!\n          checks[check.checkId] = check;\n          //add checkDetails object\n          checks[check.checkId].checkDetails = {};\n        })\n        return this.getCheckDetails( checkIds )\n      })\n      .then( checkDetailsData => {\n        //add check details to checks object\n        checkDetailsData.checkDetails.forEach( function (checkDetails) { //also returned as object containing array\n          checks[checkDetails.checkId].checkDetails[checkDetails.checkDetailId] = checkDetails;\n        })\n        //loop through reservations and apply check details\n        let resKeys = Object.keys(this.eventReservations);\n        for (const resKey of resKeys) {\n          //loop through checks\n          let checkKeys = Object.keys(this.eventReservations[resKey].checks);\n          for (const checkKey of checkKeys) {\n            this.eventReservations[resKey].checks[checkKey] = checks[checkKey];\n          }\n        }\n        resolve(true);\n      })\n      .catch( err => {\n        resolve( err ); //needs ot be resolve to keep going through flow\n      })\n\n  }.bind(this))\n}\n\nEvents.prototype.getEventReservations = function(){\n  return new Promise( function( resolve, reject ){\n\n    //fetch event reservations from start date time\n    let api = this.api;\n    let eventReservationIds = [];\n    let allEventTypeIds = [this.eventTypeId];\n    allEventTypeIds = allEventTypeIds.concat(this.otherEventTypeIds.trackEventTypes);\n    let eventResQueryString = api.base_url + 'eventReservations?key=' + api.api + '&limit=' + api.limit +\n    '&where={\"status\":{\"in\":[1,2,3,5,6]}, \"deleted\":\"false\", \"startTime\": {\"$gte\":\"' + this.startDate + 'T00:00:00\", \"$lte\":\"' + this.endDate + 'T23:59:00\"}, \"eventTypeId\":{\"in\":[' + allEventTypeIds + ']}}';\n\n    fetch( eventResQueryString )\n      .then( response => api.checkResponse(response) )\n      .then( response => api.returnJson(response) )\n      .then( eventReservations => {\n        if( eventReservations.length ){\n          eventReservations.forEach( function( result ){\n            //set if hidden event (not booking event type, or in other event types)\n            let hidden = (this.eventTypeId == result.eventTypeId || this.siblingEventTypeIds.indexOf( result.eventTypeId ) > -1 ) ? false : true;\n            //set hidden if single res\n            if( this.singleReservation ){\n              hidden = true;\n            }\n            //hide if event staus is 4 or 5\n            if( result.status === 4 || result.status === 5){\n              hidden = true;\n            }\n            //create event reservation object\n            let eventReservation = new EventReservation( result.eventReservationId, result.description, result.endTime, result.eventTypeId, result.minNoOfAdultsPerBooking, result.minNoOfCadetsPerBooking, result.noOfCadetRacers, result.noOfRacers, result.noOfTotalRacers, result.notes, result.startTime, result.status, result.subject, result.externalSystemId, result.typeId, hidden );\n            //push to response object\n            this.eventReservations[result.eventReservationId] = eventReservation;\n            //add to array of ids for obtaining events\n            eventReservationIds.push(result.eventReservationId);\n          }.bind(this))\n        }\n        resolve(eventReservationIds);\n      })\n      .catch( err => {\n        reject( err )\n      })\n  }.bind(this))\n}\n\nEvents.prototype.getEvents = function( eventReservationIds ){\n  return new Promise( function( resolve, reject ){\n\n    let api = this.api;\n\n    let eventsQueryString = api.base_url + 'events?key=' + api.api + '&limit=' + api.limit + '&where={\"reservationId\":{\"in\":[' + eventReservationIds + ']}}';\n\n    fetch( eventsQueryString )\n      .then( response => api.checkResponse(response) )\n      .then( response => api.returnJson(response) )\n      .then( eventsData => {\n        eventsData.forEach( function(result) {\n          //create event and addd to wrapper\n          let event = new Event(\n           result.eventDesc, result.eventDuration, result.eventId, result.eventScheduledTime, result.eventTypeId, result.eventTypeName, result.reservationId, result.trackNo\n          );\n          this.eventReservations[result.reservationId].event = event;\n        }.bind(this))\n        resolve(true)\n      })\n      .catch( err => {\n        reject(err)\n      })\n\n  }.bind(this))\n}\n\nEvents.prototype.getEventReservationLinks = function( eventReservationIds ){\n  return new Promise( function( resolve, reject ){\n\n    let api = this.api;\n    let checkIds = [];\n\n    let eventResLinksQueryString = api.base_url + 'eventReservationLinks?key=' + api.api + '&where={\"reservationId\": {\"$in\":[' + eventReservationIds + ']}}';\n\n    fetch ( eventResLinksQueryString )\n      .then( response => api.checkResponse(response) )\n      .then( response => api.returnJson(response) )\n      .then( eventResLinksData => {\n        eventResLinksData.forEach (function (eventReservationLink) {\n          this.eventReservations[eventReservationLink.reservationId].checks[eventReservationLink.checkId] = {};\n          //construct checkIds array\n          checkIds.push( eventReservationLink.checkId );\n        }.bind(this))\n\n        resolve(checkIds)\n      })\n      .catch(err => {\n        reject(err)\n      })\n\n  }.bind(this))\n}\n\nEvents.prototype.getChecks = function( checkIds ){\n\n  let api = this.api;\n\n  return new Promise( function( resolve, reject ){\n\n    let checks = {};\n\n    let checksQueryString = api.base_url + 'checks?key=' + api.api + '&where={\"checkId\": {\"$in\":[' + checkIds + ']}}';\n\n    fetch(checksQueryString)\n      .then( response => api.checkResponse(response) )\n      .then( response => api.returnJson(response) )\n      .then( checksData => {\n        resolve(checksData)\n      })\n      .catch( err => {\n        reject(err)\n      })\n  })\n}\n\nEvents.prototype.getCheckDetails = function( checkIds ){\n\n  let api = this.api;\n\n  return new Promise( function( resolve, reject ){\n\n    let checkDetailsQueryString = api.base_url + 'checkDetails?key=' + api.api + '&where={\"checkId\": {\"$in\":[' + checkIds + ']}}';\n\n    fetch(checkDetailsQueryString)\n      .then( response => api.checkResponse(response) )\n      .then( response => api.returnJson(response) )\n      .then( checkDetailsData => {\n        resolve( checkDetailsData )\n      })\n      .catch( err => {\n        reject( err )\n      })\n  })\n}\n\nEvents.prototype.getMyEventInfo = function () {\n\n  let api = this.api;\n\n  return new Promise( function( resolve, reject ){\n    let myEventsKeys = Object.keys( this.myEvents );\n\n    if( myEventsKeys.length > 0 ){\n      let getMyEventInfoString = api.base_url + 'eventReservations?key=' + api.api + '&limit=' + api.limit +\n      '&where={\"eventReservationId\":{\"$in\":[' + myEventsKeys + ']}}';\n\n      fetch( getMyEventInfoString )\n        .then( response => api.checkResponse(response) )\n        .then( response => api.returnJson(response) )\n        .then( eventReservations => {\n          eventReservations.forEach( function( eventReservation ){\n            if( this.myEvents[eventReservation.eventReservationId] ){\n              this.myEvents[eventReservation.eventReservationId].startTime = eventReservation.startTime;\n              this.myEvents[eventReservation.eventReservationId].endTime = eventReservation.endTime;\n            }\n          }.bind(this))\n          resolve( true );\n        })\n        .catch( err => {\n          reject( err );\n        })\n    } else {\n      resolve( 'Nothing in cart!' );\n    }\n\n  }.bind(this))\n\n};\n\nEvents.prototype.constructTimeslots = function () {\n  //vars\n  let startDate = moment(this.startDate);\n  let endDate = moment(this.endDate);\n  let startingMoment = startDate;\n\n  while(startingMoment <= endDate) {\n      let thisDate = startingMoment.clone().format('YYYY-MM-DD');\n      //construct array of moment objects for timeslots\n      let startTimeMoment = moment(thisDate+' '+this.scheduleSettings.start, 'YYYY-MM-DD kmm');\n      let endTimeMoment = moment(thisDate+' '+this.scheduleSettings.end, 'YYYY-MM-DD kmm');\n      this.timeslots[thisDate] = {\n        times: {},\n        eventReservations: []\n      };// clone to add new object\n\n      while (startTimeMoment <= endTimeMoment) {\n        let timeslotMoment = startTimeMoment.clone();\n        let timeSlotIndex = startTimeMoment.clone().format('Hmm');\n        //add to array\n        this.timeslots[thisDate].times[timeSlotIndex] = false;\n        //check not too soon\n        this.timeslots[thisDate].times[timeSlotIndex] = this.checkNotTooSoon( startTimeMoment );\n        //set to filled if within booking event duration of closing time\n        if(startTimeMoment > endTimeMoment.clone().subtract(this.duration, 'm')){\n          //console.log(startTimeMoment.format('Hmm'));\n          this.timeslots[thisDate].times[timeSlotIndex] = true;\n        }\n\n        startTimeMoment.add(this.scheduleSettings.period, 'm');\n      }\n      startingMoment.add(1, 'days');\n  }\n}\n\nEvents.prototype.checkNotTooSoon = function ( startTimeMoment ) {\n\n  let minKartingTime = 2;\n  let minGeneralTime = 48;\n  let dayLimitations = {\n    'saturday':{\n      start: 9,\n      end: 22,\n      maxGroupSize: null\n    },\n    'sunday':{\n      start: 9,\n      end: 22,\n      maxGroupSize: 15 // was 8\n    },\n    'default':{\n      start: 12,\n      end: 18,\n      maxGroupSize: 15 // was 8\n    }\n  }\n\n  //if karting\n  if( (this.eventType.trackId == 1 || this.eventType.trackId == 3) ){\n    //check day\n    let day = startTimeMoment.format('dddd').toLowerCase();\n    //set start and finish and group limit depending on day\n    let limitations = ( dayLimitations[day] ) ? dayLimitations[day] : dayLimitations.default;\n\n    let checkMinTime = moment().add(minKartingTime, 'h');\n    let checkTimeOneDay = moment().add(24, 'h');\n    let allowedStartTime = moment(this.startDate).clone().hour( limitations.start );\n    let allowedEndTime = moment(this.startDate).clone().hour( limitations.end ).subtract(this.duration, 'm');\n    //set filled if less than min start time away\n    if (startTimeMoment <= checkMinTime){\n      //console.info(startTimeMoment.clone().format('Hmm') + 'within 2 hours');\n      return true;\n    }\n    //other checks - within 24 hours\n    if(startTimeMoment <= checkTimeOneDay ){\n      //check within allowed hours\n      if(startTimeMoment < allowedStartTime || startTimeMoment > allowedEndTime){\n        //console.info(startTimeMoment.clone().format('Hmm') + 'out of allowed hours')\n        return true;\n      } else {\n        //if within allowed hours, check group size\n        if( limitations.maxGroupSize ){\n          //return filled if greater\n          if( this.bookingQty > limitations.maxGroupSize ){\n            //console.info(startTimeMoment.clone().format('Hmm') + 'allowed hours, but group size too big');\n            return true;\n          }\n        }\n      }\n    }\n  } else {\n    //not karting\n    let checkTime = moment().add(minGeneralTime, 'h');\n    if (startTimeMoment.clone() <= checkTime){\n      //console.info(startTimeMoment.clone().format('Hmm') + 'within 48 hours - not karting')\n      return true;\n    }\n  }\n  //default to timeslot not filled\n  return false;\n};\n\nEvents.prototype.setMaxParticipants = function( startTimeMoment, maxParticipants ){\n  let dayLimitations = {\n    'saturday':{\n      max: maxParticipants\n    },\n    'sunday':{\n      max: 15 // was 8\n    },\n    'default':{\n      max: 15 // was 8\n    }\n  }\n  //check day\n  let day = startTimeMoment.format('dddd').toLowerCase();\n  //set start and finish and group limit depending on day\n  let limitations = ( dayLimitations[day] ) ? dayLimitations[day] : dayLimitations.default;\n  let checkTimeOneDay = moment().add(24, 'h');\n  //if karting\n  if( this.eventType.trackId == 1 ){\n    //if within 24 hours\n    if(startTimeMoment <= checkTimeOneDay ){\n      //set limitation\n      return limitations.max;\n    }\n  }\n\n  return maxParticipants;\n}\n\nEvents.prototype.fillTimeslots = function () {\n  //fill for events\n  if(this.eventReservations){\n    let eventResKeys = Object.keys(this.eventReservations);\n    for (const eventResKey of eventResKeys) {\n\n      let eventRes = this.eventReservations[eventResKey];\n\n      let startTime = moment(eventRes.startTime);\n      let endTime = moment(eventRes.endTime);\n      let startingMoment = startTime.clone().subtract(this.duration - this.scheduleSettings.period, 'm');\n      let dateIndex = moment(eventRes.startTime).format('YYYY-MM-DD');\n      //loop through\n      while (startingMoment < endTime) {\n        let timeslotIndex = startingMoment.format('Hmm');\n        this.timeslots[dateIndex].times[timeslotIndex] = true;\n        startingMoment.add(this.scheduleSettings.period, 'm');\n      }\n\n      //add eventResId to timeslots\n      this.timeslots[dateIndex].eventReservations.push(eventRes.eventReservationId);\n    }\n  }\n}\n\nEvents.prototype.overlapsEventsInCart = function( startTime, endTime = null ){\n\n  let overlaps = false;\n  let start = moment(startTime);\n  let end = ( endTime ) ? moment(endTime) : start.clone().add( this.duration, 'm') ;\n\n  let myEventsKeys = Object.keys( this.myEvents );\n  if( myEventsKeys.length ){\n    myEventsKeys.forEach( function( myEventResKey ){\n      let myEventRes = this.myEvents[myEventResKey];\n      let myEventResStart = moment( myEventRes.startTime );\n      let myEventResEnd = moment( myEventRes.endTime );\n\n      //check booking event start\n      if( start.isAfter(myEventResStart.subtract(30, 'm')) && start.isBefore(myEventResEnd.add(30, 'm')) ){\n        //console.info('start overlaps');\n        overlaps = true;\n      }\n      //check booking event end\n      if( end.isAfter(myEventResStart.subtract(30, 'm')) && end.isSameOrBefore(myEventResEnd.add(30, 'm')) ){\n        console.info('end overlaps');\n        overlaps = true;\n      }\n\n    }.bind(this))\n  }\n\n  return overlaps;\n}\n\nEvents.prototype.drawEvents = function() {\n\n  let availableEvents = 0;\n  let unavailableEvents = 0;\n\n  //fill for events\n  if(this.eventReservations){\n    let eventResKeys = Object.keys(this.eventReservations);\n    for (const eventResKey of eventResKeys) {\n      let eventRes = this.eventReservations[eventResKey];\n      let startTime = moment(eventRes.startTime).format('kmm');\n      let startTimeMoment = moment(eventRes.startTime);\n      let endTime = moment(eventRes.endTime).format('kmm');\n      let duration = parseInt(this.duration, 10);\n      // let endTime = moment(eventRes.startTime).add(duration, 'minutes').format('kmm');\n      //check start time and end time are within grid - modify if not\n      if( parseInt(startTime, 10) < parseInt(this.schedule.start, 10) ){\n        //too early!\n        this.schedule.modifyStartTime( parseInt(startTime, 10) );\n      }\n      if( parseInt(endTime, 10) > parseInt(this.schedule.end, 10) ){\n        //too late!\n        this.schedule.modifyEndTime( parseInt(endTime, 10) );\n      }\n\n      //get product info and participants if booking product\n      let product = null;\n      let productId = null;\n      let currentParticipants = 0;\n      let productNameText = this.product.description; //only applies to booking product\n      if( (eventRes.eventTypeId === this.eventTypeId || this.siblingEventTypeIds.indexOf(eventRes.eventTypeId) > -1) && !eventRes.hidden ){\n        //get product variation details\n        product = this.getProductVariation( moment(eventRes.startTime) );\n        if( product ){\n          productNameText = product.wcName;\n          productId = product.productId;\n          currentParticipants = eventRes.getCurrentParticipants( this.productVariations[productId].product );\n        } else {\n          if( this.setTimesOnly ){\n            eventRes.hidden = true;\n          } else {\n            product = this.product;\n            currentParticipants = eventRes.getCurrentParticipants( this.product );\n          }\n        }\n      }\n      //get max participnats - time dependent\n      let maxParticipants = this.setMaxParticipants( startTimeMoment, eventRes.noOfTotalRacers );\n      //check spaces remaining\n      if ( (maxParticipants - currentParticipants) < this.bookingQty ){\n        eventRes.hidden = true;\n      }\n      //check start time not too soon\n      if( this.checkNotTooSoon( startTimeMoment ) ){\n        eventRes.hidden = true;\n      }\n      //check against start and end of current events in cart\n      if( this.overlapsEventsInCart( eventRes.startTime, eventRes.endTime ) ){\n        eventRes.hidden = true;\n      }\n\n      let eventEl = document.createElement('article');\n      let productName = document.createElement('h4');\n      //set product name\n      let productNameTextNode = document.createTextNode(productNameText);\n      productName.appendChild( productNameTextNode );\n      // let reservationDesc = document.createTextNode(event.reservation.description);\n      let remainingPlaceInfo = document.createElement('p');\n      let remainingPlaceText = document.createTextNode( (maxParticipants - currentParticipants) + ' places remaining.');\n      remainingPlaceInfo.appendChild( remainingPlaceText )\n\n      eventEl.id = eventRes.eventReservationId;\n      eventEl.classList.add('schedule-event');\n      eventEl.setAttribute('data-curr-participants', currentParticipants);\n      eventEl.setAttribute('data-max-participants', maxParticipants);\n      eventEl.setAttribute('data-event-type-id', eventRes.eventTypeId);\n      eventEl.style.cssText = 'grid-row: row' + startTime + ' / row' + endTime + '; grid-column: 2 / span 1;';\n      //no details if this hidden or not in my events\n      if( !eventRes.hidden ){\n        eventEl.appendChild(productName);\n        eventEl.appendChild(remainingPlaceInfo);\n        eventEl.setAttribute('data-eventresid', eventRes.eventReservationId);\n        eventEl.setAttribute('data-product-id', product.productId);\n        eventEl.addEventListener('click', this.showEventDetails.bind(this));\n        availableEvents++;\n      } else {\n        eventEl.classList.add('hidden');\n        unavailableEvents++;\n      }\n      this.schedule.targetEl.appendChild(eventEl);\n    };\n  }\n\n  return {\n    available: availableEvents,\n    unavailable: unavailableEvents\n  };\n}\n\nEvents.prototype.drawAddButtons = function () {\n  let schedule = document.getElementById('schedule');\n  let dateIndex = moment(this.startDate).format('YYYY-MM-DD');\n  let dayIndex = moment(this.startDate).format('dddd').toLowerCase();\n  let dayInfo = this.eventDayInfo[dayIndex];\n  let total = 0;\n\n  let drawAddButton = function( timeslot, product ){\n    //draw add button\n    let addButton = document.createElement('div');\n    //set datetime as attribute\n    let dateTimeString = dateIndex + ' ' + timeslot;\n    addButton.setAttribute('data-start', dateTimeString);\n    addButton.addEventListener('click', e => { this.showEventDetails( e, true, null, null ) });\n    addButton.classList.add('add_button');\n    addButton.style.cssText = 'grid-row: row' + timeslot + ' / span 1; grid-column: 2 / span 1;';\n    //set product vars\n    if( product ){\n      let price = toCurrency( parseFloat(product.wcPrice, 10), '');\n      let productId = product.productId;\n      let addButtonText = product.wcName + ' (' + price + 'pp)';\n      //modify if on sale - show regular price\n      if( product.onSale && product.wcRegularPrice ){\n        let regularPrice = toCurrency( parseFloat(product.wcRegularPrice, 10), '');\n        addButtonText = product.wcName + ' (<strike>' + regularPrice + '</strike> ' + price + 'pp)';\n      }\n      addButton.setAttribute( 'data-product-id', productId );\n      addButton.innerHTML = addButtonText;\n    }\n    schedule.appendChild(addButton);\n    total++;\n  }.bind(this)\n\n  if( dayInfo.start_times == 'custom' ){\n    dayInfo.custom_start_times.forEach( function( startTime ) {\n      let startMoment = moment(dateIndex + ' ' + startTime.start_time);\n      let timeslot = startMoment.format('Hmm');\n      //check timeslot not filled\n      if( !this.timeslots[dateIndex].times[timeslot] && ! this.overlapsEventsInCart(startMoment) ){\n        let product = this.getProductVariation( moment(dateIndex + ' ' + startTime.start_time) );\n        drawAddButton( timeslot, product );\n      }\n    }.bind(this));\n  } else if (dayInfo.start_times == 'onthehour') {\n    //on the hour\n    let timeslotKeys = Object.keys(this.timeslots[dateIndex].times);\n    for (const timeslot of timeslotKeys) {\n      let startMoment = moment(dateIndex + 'T' + timeslot, 'YYYY-MM-DDTHmm');\n      //check if minutes = zero\n      if( parseInt(startMoment.format('m'), 10) == 0 ){\n        //check timeslot not full\n        if( !this.timeslots[dateIndex].times[timeslot]  && ! this.overlapsEventsInCart(startMoment) ){\n          let product = this.getProductVariation( moment(dateIndex + ' ' + startMoment.format('HH:mm')) );\n          drawAddButton( timeslot, product );\n        }\n      }\n    }\n  } else if (dayInfo.start_times == 'none') {\n    return false;\n  } else {\n    //any open hour\n    //loop through timeslots if any open hour\n    let timeslotKeys = Object.keys(this.timeslots[dateIndex].times);\n    for (const timeslot of timeslotKeys) {\n      let startMoment = moment(dateIndex + 'T' + timeslot, 'YYYY-MM-DDTHmm');\n      if( !this.timeslots[dateIndex].times[timeslot]  && ! this.overlapsEventsInCart(startMoment) ){\n        let product = this.getProductVariation( moment(dateIndex + ' ' + startMoment.format('HH:mm')) );\n        drawAddButton( timeslot, product );\n      }\n    }\n  }\n\n  return total;\n}\n\nEvents.prototype.showEventDetails = function (e, prospective, passedEventResId, isFamilyEvent) {\n\n  console.log(isFamilyEvent);\n\n  //get event object\n  let eventReservationId = null;\n  if (passedEventResId){\n    eventReservationId = passedEventResId;\n  } else {\n    eventReservationId = (prospective) ? null : e.target.getAttribute('data-eventresid');\n  }\n\n  let currentParticipants = e.target.getAttribute('data-curr-participants');\n  let maxParticipants = e.target.getAttribute('data-max-participants');\n\n  let eventRes = (prospective) ? null : this.eventReservations[eventReservationId];\n  let eventId = (prospective) ? null : eventRes.event.eventId ;\n\n  let start = (prospective) ? moment(e.target.getAttribute('data-start'), 'YYYY-MM-DD Hmm') : moment(eventRes.startTime);\n  //set product, product name, and price by time variation\n  // let product = this.getProductVariation( start );\n  let productId = e.target.getAttribute('data-product-id');\n  let product = ( productId ) ? this.productVariations[productId].product : this.product ;\n  let productName = product.wcName;\n\n  // needs catch for wcProductId if product fully booked\n  let wcProductId = (this.productVariations[productId].wcProductId) ? this.productVariations[productId].wcProductId : this.wcProductId ;\n\n  let price = (product.wcPrice > 0) ? product.wcPrice : this.wcPrice\n  let regularPrice = (product.wcRegularPrice > 0) ? product.wcRegularPrice : this.wcRegularPrice\n  let onSale = (product.onSale) ? product.onSale : this.onSale ;\n  let inductionPrice = (inductionInfo) ? inductionInfo.wcPrice : null ;\n  //set parent for expand\n  let schedule = this.schedule;\n  let newReservationForm = null;\n\n  expand(e.target, schedule, 'reservation_form', 'form')\n    .then( function(reservationForm) {\n      let autoLoadForm = (passedEventResId) ? 1 : 0;\n      newReservationForm = new ReservationForm( reservationForm, autoLoadForm, isFamilyEvent, this.bookingQty, this.qtyCadets, this.qtyInduction, price, regularPrice, onSale, inductionPrice, this.partyInfo );\n\n      reservationForm.onsubmit = this.makeReservation.bind(this);\n      newReservationForm.addFormElements(reservationForm, eventId, eventReservationId, productName, start, this.duration,  productId, wcProductId, this.eventType.trackId, this.currentUser, currentParticipants, maxParticipants, isFamilyEvent );\n      if( qtyInduction > 0){\n        this.loadInductionStartTimes( start, newReservationForm );\n      }\n      if (autoLoadForm) {\n        newReservationForm.inductionsInput.addEventListener('change', e => {\n          if(e.target.value > 0 ){\n            let inductionSelectEl = reservationForm.getElementsByClassName('induction-select')[0];\n            inductionSelectEl.style.display = \"block\";\n            let inductionTimesEl = inductionSelectEl.getElementsByClassName('induction-times')[0];\n            // //inductionTimesEl.innerHTML = \"\";\n            if(inductionTimesEl.getElementsByTagName('LABEL').length > 0){\n              [...inductionTimesEl.getElementsByTagName('LABEL')].forEach( label => {\n                label.parentNode.removeChild(label);\n              });\n            }\n            if(inductionTimesEl.getElementsByTagName('INPUT').length > 0){\n              [...inductionTimesEl.getElementsByTagName('INPUT')].forEach( input => {\n                input.parentNode.removeChild(input);\n              });\n            }\n\n            this.loadInductionStartTimes( start, newReservationForm );\n            newReservationForm.onQuantityChange();\n          }\n        })\n        //addEventListener('change', this.onQuantityChange.bind(this) );\n      }\n      return true;\n    }.bind(this))\n}\n\nEvents.prototype.checkAvailability = function() {\n  let start = moment(this.startDate + 'T00:00:00');\n  let end = moment(this.endDate + 'T23:59:59');\n  let now = moment();\n\n  if( start.isBefore(now) ){\n    start = now;\n  }\n\n  let startMoment = start.clone();\n\n  while( startMoment <= end ){\n    let availability = this.checkAvailabilityByDate( startMoment );\n    let dateElement = document.getElementById( startMoment.format('YYYY-MM-DD') );\n    if(!availability){\n      dateElement.classList.add('unavailable');\n    }\n    startMoment.add(1, 'd');\n  }\n}\n\nEvents.prototype.checkAvailabilityByDate = function( date ){\n\n  let dateIndex = date.format('YYYY-MM-DD');\n  let eventReservationIds = this.timeslots[dateIndex].eventReservations;\n  let dayIndex = date.format('dddd').toLowerCase();\n  let dayInfo = this.eventDayInfo[dayIndex];\n\n  //loop through event reses - check for product and then participants\n  let freeEvent = false;\n  if( eventReservationIds.length > 0 ){\n    eventReservationIds.forEach( function( eventReservationId ){\n      let eventReservation = this.eventReservations[eventReservationId];\n      //check for event type\n      if( eventReservation.eventTypeId === this.eventTypeId ){\n        //get product variation from start time\n        let start = moment( eventReservation.startTime );\n        let product = this.getProductVariation( start, false );\n        if( product ){\n          if( product.productId === this.product.productId ){\n            //check for participants\n            let currentParticipants = eventReservation.getCurrentParticipants();\n            let maxParticipants = eventReservation.noOfTotalRacers;\n            // console.info(eventReservation.eventReservationId, currentParticipants, maxParticipants)\n            if( currentParticipants + this.bookingQty <= maxParticipants ){\n              freeEvent = true;\n            }\n          }\n        }\n      }\n    }.bind(this))\n  }\n\n  if(freeEvent){\n    return true;\n  }\n\n  //if can create new events, check if a starting timeslot\n  let availableSlot = false;\n  if(this.newReservations){\n    if( dayInfo.start_times == 'custom' ){\n      dayInfo.custom_start_times.forEach( function( startTime ) {\n        let timeslot = moment(dateIndex + ' ' + startTime.start_time).format('Hmm');\n        //check timeslot not filled\n        if(!this.timeslots[dateIndex].times[timeslot]){\n          availableSlot = true;\n        }\n      }.bind(this));\n    } else if (dayInfo.start_times == 'onthehour') {\n      //on the hour\n      let timeslotKeys = Object.keys(this.timeslots[dateIndex].times);\n      for (const timeslot of timeslotKeys) {\n        let startMoment = moment(timeslot, 'Hmm');\n        //check if minutes = zero\n        if( parseInt(startMoment.format('m'), 10) == 0 ){\n          //check timeslot not full\n          if(!this.timeslots[dateIndex].times[timeslot]){\n            availableSlot = true;\n          }\n        }\n      }\n    } else if (dayInfo.start_times == 'none') {\n      return false;\n    } else {\n      //any open hour\n      //loop through timeslots if any open hour\n      let timeslotKeys = Object.keys(this.timeslots[dateIndex].times);\n      for (const timeslot of timeslotKeys) {\n        if(!this.timeslots[dateIndex].times[timeslot]){\n          availableSlot = true;\n        }\n      }\n    }\n  }\n\n  if(availableSlot){\n    return true;\n  }\n\n  //if get all the way through there is no availability\n  return false;\n}\n\nEvents.prototype.isValidStartTime = function( start, productId ){\n\n  //get day\n  let eventDay = start.clone().format('dddd').toLowerCase();\n  let eventStartTime = start.clone().hour();\n  let eventDateIndex = start.format('YYYY-MM-DD');\n\n  let scheduleStartTime = ( this.schedule ) ? moment(this.schedule.start, 'HHmm') : moment( eventDateIndex + 'T08:00') ;\n  let scheduleEndTime = ( this.schedule) ? moment(this.schedule.end, 'HHmm').subtract( this.duration, 'm' ) : moment( eventDateIndex + 'T22:00') ;\n\n  let startTimes = 'anyopen';\n\n  if( typeof this.productVariations[productId].startTimes[eventDay] !== 'undefined' ){\n    startTimes = this.productVariations[productId].startTimes[eventDay].start_times;\n  }\n\n  //check in opening hours\n  if( start < scheduleStartTime && start > scheduleEndTime ){\n    //console.log('not in opening hours');\n    return false;\n  }\n\n  //if any open\n  if( startTimes == 'anyopen' ){\n    return true;\n  }\n  if( startTimes == 'onthehour' ){\n    if( parseInt(start.format('m'), 10) == 0 ){\n      return true;\n    }\n  }\n  if( startTimes == 'custom' ){\n    let customStartTimes = this.productVariations[productId].startTimes[eventDay].custom_start_times;\n    let found = false;\n    if( customStartTimes.length > 0 ){\n      customStartTimes.forEach( function( startTime ){\n        let startTimeMoment = moment( eventDateIndex + 'T' + startTime.start_time );\n        if( start.isSame(startTimeMoment) ){\n          found = true;\n        }\n      })\n      if(found){\n        return true;\n      }\n    }\n  }\n\n  return null;\n}\n\nEvents.prototype.isVariationPeriod = function ( start, productId ) {\n\n  if( typeof this.productVariations[productId].includedPeriods !== 'undefined' ){\n    //get day\n    let eventDay = start.clone().format('dddd').toLowerCase();\n    let eventStartTime = start.clone().hour();\n    let eventDateIndex = start.format('YYYY-MM-DD');\n\n    if( this.productVariations[productId].includedPeriods.length > 0 ){\n\n      let valid = false;\n\n      this.productVariations[productId].includedPeriods.forEach( function( period ){\n        //check day exists\n        if( period.day.indexOf(eventDay) > -1 ){\n          //check times set\n          if( period.included_times.length > 0){\n            period.included_times.forEach( function( timeSet ){\n              let startTime = moment( eventDateIndex + 'T' + timeSet.start_time);\n              let endTime = moment( eventDateIndex + 'T' + timeSet.end_time);\n              // console.log(startTime, endTime);\n              //check start in between\n              if( start.isSameOrAfter(startTime) && start.isSameOrBefore(endTime) ){\n                valid = true;\n              }\n            })\n          }\n        }\n      })\n\n      //if valid return true\n      if( valid ){\n        return true;\n      }\n\n    }\n  }\n\n  return false;\n\n};\n\nEvents.prototype.getProductVariation = function ( start, checkSchedule ) {\n  //get default product\n  let product = null;\n\n  //check if product can start in main event start times\n  if ( this.isValidStartTime( start, this.product.productId ) ){\n    product = this.product;\n  }\n\n  //check if in each of the variations\n  if( typeof this.productVariations !== 'undefined' ){\n    let productIds = Object.keys(this.productVariations).map( key => parseInt( key, 10 ));\n    let foundProductId = null;\n    productIds.forEach( function( productId ){\n      //check not main product id\n      if( productId !== this.product.productId ){\n        if ( this.isValidStartTime( start, productId ) || this.isVariationPeriod( start, productId ) ){\n          foundProductId = productId;\n        }\n      }\n    }.bind(this))\n    if( foundProductId ){\n      product = this.productVariations[foundProductId].product;\n    }\n  }\n\n  return product;\n}\n\nEvents.prototype.loadInductionStartTimes = function ( start, reservationForm ) {\n  this.getInductionStartTimes( start )\n    .then( function(times){\n      if(times){\n        let limit = 5;\n        times.forEach( function( time, index ) {\n          this.checkTimeAvailable( time, 3, parseInt(this.inductionInfo.event_type_id, 10) )\n            .then( response => {\n              //if empty append induction radio\n              if( response.available && limit > 0 ){\n                let inductionEventResId = ( response.eventReservationId ) ? response.eventReservationId : null ;\n                let inductionEventId = ( response.eventId ) ? response.eventId : null ;\n                reservationForm.addInductionTime( time, index, inductionEventResId, inductionEventId );\n                limit--;\n              }\n              return true;\n            })\n        }.bind(this))\n      } else {\n        reservationForm.noInductionsAvailable();\n      }\n    }.bind(this))\n};\n\nEvents.prototype.getInductionStartTimes = function ( start ) {\n  return new Promise( function( resolve, reject ){\n\n    let possibleInductionTimes = [];\n\n    //get most recent possible start times - today\n    let today = start.clone().format('dddd').toLowerCase();\n    let date = start.clone().format('YYYY-MM-DD');\n    let inductionDuration = this.inductionInfo.duration;\n    let checkTime = start.clone().subtract(parseInt( inductionDuration, 10 ), 'm');\n    //get track opening times\n    let trackOpeningDetails = this.schedule.tracks.track_info[this.inductionInfo.track].opening_hours[today];\n    let trackOpen = moment(date + 'T' + trackOpeningDetails.open);\n    let trackClose = moment(date + 'T' + trackOpeningDetails.close);\n    let trackClosed = trackOpeningDetails.closed;\n    if( ! trackClosed ){\n      //get induction possible times\n      let inductionStartTimes = this.inductionInfo.event_day_info[today];\n      //if any open hour\n      if( inductionStartTimes.start_times == 'custom' ){\n        //loop through custom times\n        inductionStartTimes.custom_start_times.forEach( function( startTime ){\n          let startTimeMoment = moment( date + 'T' + startTime.start_time);\n          if( startTimeMoment <= checkTime && startTimeMoment > moment() ){\n            possibleInductionTimes.push( startTimeMoment.clone() );\n          }\n        }.bind(this))\n      } else {\n        //any open\n        let startTimeMoment = checkTime;\n        while( startTimeMoment > trackOpen ){\n          possibleInductionTimes.push( startTimeMoment.clone() );\n          startTimeMoment.subtract( parseInt( inductionDuration, 10 ), 'm' );\n        }\n      }\n\n      //resovle if lnegth\n      if( possibleInductionTimes.length > 0 ){\n        resolve( possibleInductionTimes )\n      } else {\n        resolve( false );\n      }\n    } else {\n      resolve( false );\n    }\n\n  }.bind(this))\n}\n\nEvents.prototype.checkTimeAvailable = function ( time = moment(), trackId, eventTypeId ) {\n  return new Promise( function( resolve, reject ){\n\n    let eventReservation = null;\n\n    let eventTypesQueryString = this.api.base_url + 'eventTypes?key=' + this.api.api + '&limit=' + this.api.limit + '&where={\"deleted\":\"false\", \"trackId\":{\"in\":[' +\n    trackId + ']}}';\n\n    fetch( eventTypesQueryString )\n      .then( response => this.api.checkResponse(response) )\n      .then( response => this.api.returnJson(response) )\n      .then( eventTypeData => {\n        let eventTypeIds = [];\n        eventTypeData.forEach( eventType => {\n          eventTypeIds.push( eventType.eventTypeId )\n        })\n        let eventResQueryString = this.api.base_url + 'eventReservations?key=' + this.api.api + '&limit=' + this.api.limit +\n        '&where={\"$and\":[{\"status\":{\"$in\":[2,3]}}, {\"deleted\":\"false\"}, {\"eventTypeId\":{\"in\":[' + eventTypeIds + ']}}, {\"startTime\": {\"$lte\":\"' + time.format('YYYY-MM-DDTHH:mm:ss') + '\"}}, {\"startTime\": {\"$gte\":\"' + time.format('YYYY-MM-DDTHH:mm:ss') + '\"}}]}';\n        return fetch( eventResQueryString );\n      })\n      .then( response => this.api.checkResponse(response) )\n      .then( response => this.api.returnJson(response) )\n      .then( resEventReservations => {\n        //only interested in one event res as should only be one at that time on track\n        if( resEventReservations.length > 0 ){\n          eventReservation = resEventReservations[0];\n          eventReservation.event = {};\n          let reservationId = eventReservation.eventReservationId;\n          //get event id\n          let eventsQueryString = this.api.base_url + 'events?key=' + this.api.api + '&limit=' + this.api.limit +\n          '&where={\"reservationId\":' + reservationId + '}';\n          return new Promise( function ( resolve, reject ) {\n            fetch( eventsQueryString )\n              .then( response => this.api.checkResponse(response) )\n              .then( response => this.api.returnJson(response) )\n              .then( events => {\n                if( events.length > 0 ){\n                  //only first event\n                  eventReservation.event = events[0];\n                }\n                resolve(events);\n              })\n              .catch( err => {\n                reject(err);\n              })\n          }.bind(this))\n        } else {\n          return true;\n        }\n      })\n      .then( res => {\n        //console.log(eventReservation);\n        if(eventReservation){\n          //check if event type match\n          if( eventReservation.eventTypeId === eventTypeId ){\n            resolve( { available: true, eventReservationId: eventReservation.eventReservationId, eventId: eventReservation.event.eventId } )\n          } else {\n            resolve( { available: false } )\n          }\n        } else {\n          resolve( { available: true } )\n        }\n      })\n      .catch( err => {\n        reject( err );\n      })\n\n  }.bind(this))\n};\n\nEvents.prototype.makeReservation = function (e) {\n  e.preventDefault();\n  e.target.submitButton.disabled = true;\n\n  let messageBox = document.createElement('div');\n  messageBox.classList.add('make-res-message');\n\n  let messagePara = document.createElement('p');\n  messagePara.innerHTML = 'Please wait while we connect to our booking system...'; \n  messageBox.appendChild( messagePara );\n  \n  showOverlay( true, true, messageBox, true ); //sub and loading and no content\n\n  //get product and details \n  let productId = e.target.elements['product-id'].value;\n  let product = this.productVariations[productId].product;\n  let wcProductId = e.target.elements['wc-product-id'].value;\n  //get information from form being submitted\n  let eventReservationId = e.target.elements['event-reservation-id'].value;\n  //console.log(eventReservationId);\n  let eventId = e.target.elements['event-id'].value;\n  let now = moment().format('YYYY-MM-DDTHH:mm:ss');\n  let startValue = e.target.elements['start'].value;\n  let start = moment(startValue);\n  let end = start.clone().add(parseInt(this.duration, 10), 'm');\n  let subtotal = e.target.elements['subtotal'].value;\n  let qty = e.target.elements['qty'].value;\n  let qtyCadets = e.target.elements['qty-cadets'].value;\n  let qtyAdults = parseInt(qty, 10) - parseInt(qtyCadets, 10);\n  let email = e.target.elements['email'].value;\n  let name = e.target.elements['name'].value;\n  let telephone = e.target.elements['telephone'].value;\n  let firstName = name.split(' ')[0];\n  let lastName = name.split(' ')[name.split(' ').length -1];\n\n  // store email address in local storage for logging\n  createCookie(\"emailAddr\", email, 10);\n\n  let qtyInduction = null;\n  if (e.target.elements['qty-induction'].length > 1) {\n    qtyInduction = e.target.elements['qty-induction'].value;\n  } else {\n    qtyInduction = this.qtyInduction;\n  }\n\n  //qtys\n  let noOfCadetRacers = this.maxRacersFromHeatTypes.cadets;\n  let noOfTotalRacers = this.maxRacersFromHeatTypes.total;\n  let noOfRacers = noOfTotalRacers - noOfCadetRacers;\n\n  //induction values\n  let inductionTime = ( qtyInduction > 0 ) ? e.target.elements['induction-time'].value : null ;\n  let inductionEventResId = null;\n  let inductionEventId = null;\n  //get induction event res id of selected radio\n  if( qtyInduction > 0 ){\n    let inductionTimeElements = e.target.elements['induction-time'];\n    if( e.target.elements['induction-time'].length > 0 ){\n      [...e.target.elements['induction-time']].forEach( function( input ){\n        if(input.checked){\n          inductionEventResId = input.getAttribute( 'data-event-reservation' );\n          inductionEventId = input.getAttribute( 'data-event-id' );\n        }\n      })\n    } else {\n      inductionEventResId = inductionTimeElements.getAttribute( 'data-event-reservation' );\n      inductionEventId = inductionTimeElements.getAttribute( 'data-event-id' );\n    }\n\n  }\n\n  //event reservation object\n  let newEventReservation = new EventReservation( eventReservationId, 'Online Event reservation', end.clone().format('YYYY-MM-DDTHH:mm:ss'), this.eventTypeId, 1, 0, noOfCadetRacers, noOfRacers, noOfTotalRacers, 'Event reservation notes here', start.clone().format('YYYY-MM-DDTHH:mm:ss'), 2, 'Online: ' + this.wcEventTitle, 'KNE Website Online Booking System', this.eventType.trackId );\n\n  //event object\n  let newEvent = new Event('New reservation event', this.duration, eventId, start.clone().format('YYYY-MM-DDTHH:mm:ss'), this.eventTypeId, this.eventType.eventTypeName, eventReservationId, this.eventType.trackId, this.eventHeatTypes);\n  //check object\n  let checkNotes = 'Total Qty: '+qty+', Qty Adults: '+qtyAdults+', Qty Cadets: '+qtyCadets;\n  let newCheck = new Check( null, null, 2, 0, 'TEST Online check for event '+eventId, subtotal, checkNotes, now );\n  //check details object\n  let rPoints = 1;\n  if( this.partyInfo.guests > 0 ){\n    rPoints = this.partyInfo.guests;\n  }\n  //set r_points for party\n  let newCheckDetails = new CheckDetails( null, null, 1, 4, product.productId, product.description, now, qtyAdults, qtyCadets, product.wcPrice, rPoints, 1 )\n  //extras check\n  let extrasCheckDetails = null;\n  if( this.partyInfo.extra_guests > 0 ){\n    let extrasQty =  this.partyInfo.extra_guests;\n    extrasCheckDetails = new CheckDetails( null, null, 1, 4, this.partyInfo.extra_guest_product_id, 'Extra event guests', now, extrasQty, 0, this.partyInfo.extra_guest_price, 1, 1 );\n  }\n  //customer object\n  let newCustomer = new Customer( this.customerId, email,\n    firstName, lastName, telephone );\n  //reservation object\n  let reservationId = moment().format('x');\n  let newReservation = new Reservation( reservationId, wcProductId, moment(), this.eventTypeId, null, null, null, null, null, null, 'open', product.wcName, null );\n\n  newEventReservation.setId( eventReservationId, this.api )\n    .then( newEventReservationId => {\n      newEvent.reservationId = newEventReservationId;\n      return newEvent.setId( eventId, this.api );\n    })\n    .then( newEventId => {\n      //console.log(newEventId);\n      return newCustomer.setCustomer(this.api);\n    })\n    .then( customerId => {\n      newCheck.customerId = customerId;\n      return newCheck.createCheckOnApi(this.api);\n    })\n    .then( newCheckId => {\n      //console.log(newCheckId);\n      newCheck.checkId = newCheckId; //set checkId\n      newCheckDetails.checkId = newCheckId;\n      if( extrasCheckDetails ){\n        extrasCheckDetails.checkId = newCheckId;\n      }\n      return newCheckDetails.createCheckDetailsOnApi(this.api);\n    })\n    .then( newCheckDetailsId => {\n      newCheckDetails.checkDetailsId = newCheckDetailsId;\n      newCheck.checkDetails[newCheckDetailsId] = newCheckDetails;\n      //extras check\n      if( extrasCheckDetails ){\n        return extrasCheckDetails.createCheckDetailsOnApi(this.api);\n      } else {\n        return null;\n      }\n    })\n    .then( extrasCheckDetailsId => {\n      if( extrasCheckDetailsId ){\n        //console.log('extras check details:'+extrasCheckDetailsId);\n        extrasCheckDetails.checkDetailsId = extrasCheckDetailsId;\n      }\n      //post eventreslink for check details - don't need extras on there as not an event\n      let postEventResLinkString = this.api.base_url + 'eventReservationLinks?key=' + this.api.api +\n        '&checkId=' + newCheck.checkId +\n        '&reservationId=' + newEventReservation.eventReservationId ;\n      //console.log(postEventResLinkString);\n      return postEventResLinkString;\n    })\n    .then( postEventResLinkString =>\n      fetch( postEventResLinkString, {method: 'POST'})\n    )\n    .then( response => {\n      if( !response.ok ){\n        throw new Error(response.statusText);\n      }\n      return response;\n    })\n    .then( response =>\n      response.json()\n    )\n    .then( eventResLinkId => {\n      //modify reservation object\n      newReservation.eventReservation = newEventReservation;\n      newReservation.eventReservation.event = newEvent;\n      //set check on event res\n      newReservation.eventReservation.checks[newCheck.checkId] = newCheck;\n      newReservation.eventReservationLink = eventResLinkId;\n      newReservation.customer = newCustomer;\n      newReservation.check = newCheck;\n      newReservation.checkDetails = newCheckDetails;\n      newReservation.extrasCheckDetails = extrasCheckDetails;\n      //return get induction events\n      if( qtyInduction > 0 ){\n        return this.makeInductionReservation( inductionEventResId, inductionEventId, inductionTime, newCheck.customerId );\n      } else {\n        return null;\n      }\n    })\n    .then( inductionDetails => {\n      newReservation.induction = inductionDetails;\n      //add reservation to local storage\n      let storage = new Storage();\n      storage.store( newReservation.reservationId, 'reservations', newReservation );\n      //console.log(newReservation);\n      return true;\n    })\n    .then( res => {\n      //redirect\n      let addToCartString = wcProductId;\n      //multiple items for induction\n      if( qtyInduction > 0 ){\n        let induction = newReservation.induction;\n        let formattedStart = moment(induction.startTime, 'YYYY-MM-DDTHH:mm:ss' ).format('YYYYMMDDTHHmmss');\n        addToCartString = wcProductId + ':' + qty + ',' + this.inductionInfo.induction_wc_product + ':' +\n        this.qtyInduction + ':' +\n        induction.eventReservationId + ':' +\n        induction.checks.checkId + ':' +\n        formattedStart;\n      }\n      //multiple items for party if extra guests\n      if( partyInfo.extra_guests > 0 ){\n        addToCartString = wcProductId + ':' + qty + ',' + this.partyInfo.extra_guest_wc_product_id + ':' + this.partyInfo.extra_guests;\n      }\n      //redirect add to cart\n      let redirectUrl = document.location.origin + '/booking-confirmation/?add-to-cart=' + addToCartString + '&quantity=' + qty + '&resid=' + newReservation.reservationId + '&checkid=' + newCheck.checkId + '&start=' + start.format('YYYYMMDDTHHmmss') + '&qtyCadets=' + qtyCadets + '&qtyInduction=' + qtyInduction + '&eventResId=' + newEventReservation.eventReservationId + '&customer=' + newCustomer.customerId + '&checkdetailsid=' + newCheckDetails.checkDetailsId + '&addedtocart=' + now + '&partyguests=' + this.partyInfo.guests;\n\n      window.location.href = redirectUrl;\n    })\n    .catch( Error => {\n      console.log(Error);\n    })\n}\n\nEvents.prototype.makeInductionReservation = function ( inductionEventResId, inductionEventId, inductionTime, customerId ) {\n  return new Promise( function( resolve, reject ){\n    //console.log('creating induction');\n\n    let inductionStart = moment(inductionTime);\n    let inductionEnd = inductionStart.clone().add(this.inductionInfo.duration, 'm');\n    let now = moment().format('YYYY-MM-DDTHH:mm:ss');\n\n    //induction event Reservation\n    let inductionEventRes = new EventReservation( inductionEventResId, 'Online induction reservation', inductionEnd.clone().format('YYYY-MM-DDTHH:mm:ss'), this.inductionInfo.event_type_id, 1, 0, qtyInduction, 0, qtyInduction, 'Induction notes', inductionStart.clone().format('YYYY-MM-DDTHH:mm:ss'), 2, 'Online: Induction', 'KNE Website Online Booking System', this.inductionInfo.track );\n\n    //induction Event\n    let inductionEvent = new Event('New induction event', this.inductionInfo.duration, inductionEventId, inductionStart.clone().format('YYYY-MM-DDTHH:mm:ss'), this.inductionInfo.event_type_id, null, inductionEventResId, this.inductionInfo.track);\n\n    let inductionCheck = new Check( null, customerId, 2, 0, 'Induction check for event reservation'+inductionEventRes, 0, 'Induction check', now );\n\n    //induction check\n    let qtyAdults = 0; //there are no adults on inductions!!\n    let inductionCheckDetails = new CheckDetails( null, null, 1, 4, this.inductionInfo.product_id, 'Induction', now, qtyAdults, this.qtyInduction, this.inductionInfo.price, 1, 1 );\n    //console.log(inductionCheckDetails);\n\n    inductionEventRes.setId( inductionEventResId, this.api )\n      .then( eventResId => {\n        inductionEvent.reservationId = eventResId;\n        return inductionEvent.setId( inductionEventId, this.api )\n      })\n      .then( eventId => {\n        inductionEventRes.event = inductionEvent;\n        return inductionCheck.createCheckOnApi(this.api);\n      })\n      .then( inductionCheckId => {\n        //console.log(inductionCheckId);\n        inductionCheck.checkId = inductionCheckId;\n        inductionEventRes.checks.checkId = inductionCheck.checkId;\n        inductionEventRes.checks.check = inductionCheck;\n        inductionCheckDetails.checkId = inductionCheckId;\n        //check details\n        return inductionCheckDetails.createCheckDetailsOnApi(this.api);\n      })\n      .then( checkDetailsId => {\n        inductionCheckDetails.checkDetailsId = checkDetailsId;\n        inductionEventRes.checks.checkDetails = inductionCheckDetails;\n        //post event res link\n        let postEventResLinkString = this.api.base_url + 'eventReservationLinks?key=' + this.api.api + '&checkId=' + inductionCheck.checkId + '&reservationId=' + inductionEventRes.eventReservationId ;\n        return postEventResLinkString;\n      })\n      .then( postEventResLinkString =>\n        fetch( postEventResLinkString, {method: 'POST'})\n      )\n      .then( response => {\n        if( !response.ok ){\n          throw new Error(response.statusText);\n        }\n        return response;\n      })\n      .then( response =>\n        response.json()\n      )\n      .then( eventResLinkId => {\n        inductionEventRes.eventReservationLink = eventResLinkId;\n        resolve( inductionEventRes )\n      })\n      .catch( err => {\n        reject(err);\n      })\n\n  }.bind(this))\n};\n\nexport default Events;\n","import Storage from '../utilities/storage.js';\n\nfunction EventType ( eventTypeId, description, eventTypeName, onlineProductId, ptsPerReservation, trackId ) {\n\n  this.eventTypeId = eventTypeId;\n  this.description = description;\n  this.eventTypeName = eventTypeName;\n  this.onlineProductId = onlineProductId;\n  this.ptsPerReservation = ptsPerReservation;\n  this.trackId = trackId;\n\n}\n\nEventType.prototype.getEventTypeById = function ( eventTypeId, api ) {\n\n  //if no id decalred just use object id\n  if(!eventTypeId){\n    let eventTypeId = this.eventTypeId;\n  }\n\n  return new Promise( function( resolve, reject ){\n    //check local storage\n    let storage = new Storage();\n    let eventTypeStorage = storage.retrieve( 'eventType' );\n    if ( eventTypeStorage ) {\n      //check for id in storage\n      if ( eventTypeStorage.items[eventTypeId] ){\n        //if exists - check hasn't expired\n        if( !storage.expired( eventTypeStorage.items[eventTypeId] ) ){\n          //set attributes\n          let result = eventTypeStorage.items[eventTypeId];\n          this.description = result.description;\n          this.eventTypeName = result.eventTypeName;\n          this.onlineProductId = result.onlineProductId;\n          this.trackId = result.trackId;\n          //resolve if meets these criteria\n          console.log(' event type fetched from storage');\n          return resolve( eventTypeStorage.items[eventTypeId] )\n        }\n      }\n    }\n    //fetch if requried\n    this.getEventTypeFromApi( api )\n      .then( eventType => {\n        console.log('from api');\n        storage.store( eventType.eventTypeId, 'eventType', eventType );\n        resolve(eventType)\n      })\n\n  }.bind(this))\n}\n\nEventType.prototype.getEventTypeFromApi = function ( api ) {\n  return new Promise( function( resolve, reject ){\n\n    let eventTypesQueryString = api.base_url + 'eventTypes/' + this.eventTypeId + '?key=' + api.api;\n    fetch( eventTypesQueryString )\n      .then( response => api.checkResponse(response) )\n      .then( response => api.returnJson(response) )\n      .then( result => {\n        this.description = result.description;\n        this.eventTypeName = result.eventTypeName;\n        this.onlineProductId = result.onlineProductId;\n        this.trackId = result.trackId;\n        resolve( result )\n      })\n      .catch( err => {\n        reject( err );\n      })\n\n  }.bind(this))\n}\n\n\nexport default EventType;\n","import Storage from '../utilities/storage.js';\n\nfunction Product ( productId, productType, description, price1, price2, r_Points, priceCadet, wcName = null) {\n\n  this.productId = productId;\n  this.productType = productType;\n  this.description = description;\n  this.price1 = price1;\n  this.price2 = price2;\n  this.r_Points = r_Points;\n  this.priceCadet = priceCadet;\n  this.wcName = wcName;\n\n}\n\nProduct.prototype.getProductById = function ( productId, api ) {\n\n  //if no id decalred just use object id\n  if(!productId){\n    let productId = this.productId;\n  }\n\n  return new Promise( function( resolve, reject ){\n    //check local storage\n    let storage = new Storage();\n    let productStorage = storage.retrieve( 'products' );\n    if ( productStorage ) {\n      //check for id in storage\n      if ( productStorage.items[productId] ){\n        //if exists - check hasn't expired\n        if( !storage.expired( productStorage.items[productId] ) ){\n          let product = productStorage.items[productId];\n          //set attributes\n          this.productId = product.productId;\n          this.productType = product.productType;\n          this.description = product.description;\n          this.price1 = product.price1;\n          this.price2 = product.price2;\n          this.r_Points = product.r_Points;\n          this.priceCadet = product.priceCadet;\n          //resolve if meets these criteria\n          console.log('product fetched from storage');\n          return resolve( productStorage.items[productId] )\n        }\n      }\n    }\n    //fetch if requried\n    this.getProductFromApi( api )\n      .then( product => {\n        console.log('from api');\n        storage.store( product.productId, 'products', product );\n        resolve(product)\n      })\n\n  }.bind(this))\n}\n\nProduct.prototype.getProductFromApi = function ( api ) {\n  return new Promise( function( resolve, reject ){\n\n    let productQueryString = api.base_url + 'products/' + this.productId + '?key=' + api.api;\n    fetch( productQueryString )\n      .then( response => api.checkResponse(response) )\n      .then( response => api.returnJson(response) )\n      .then( result => {\n        let product = result.products[0]; //products returns as products object\n\n        this.productId = product.productId;\n        this.productType = product.productType;\n        this.description = product.description;\n        this.price1 = product.price1;\n        this.price2 = product.price2;\n        this.r_Points = product.r_Points;\n        this.priceCadet = product.priceCadet;\n        resolve( product )\n      })\n      .catch( err => {\n        reject( err );\n      })\n\n  }.bind(this))\n}\n\nexport default Product;\n","function AnalyticsEvents ( gtag ) {\n  this.gtag = gtag;\n}\n\nAnalyticsEvents.prototype.bookingStart = function ( productId, productName ) {\n  return new Promise( function( resolve, reject ){\n    let result = this.gtag('event', 'Booking Start', {\n      'event_category' : 'ecommerce',\n      'event_label' : productName,\n      'value' : productId\n    });\n    console.log('Booking start event triggered' + result);\n\n    resolve(true);\n  }.bind(this))\n};\n\nAnalyticsEvents.prototype.numbersChosen = function ( totalParticipants, productId ) {\n  return new Promise( function( resolve, reject ){\n    this.gtag('event', 'Numbers Chosen', {\n      'event_category' : 'ecommerce',\n      'event_label' : productId,\n      'value' : totalParticipants\n    });\n    console.log('Numbers chosen event triggered');\n\n    resolve(true);\n  }.bind(this))\n};\n\nAnalyticsEvents.prototype.calendarDateChosen = function ( date ) {\n  return new Promise( function( resolve, reject ){\n    this.gtag('event', 'Calendar Date Chosen', {\n      'event_category' : 'ecommerce',\n      'event_label' : date\n    });\n    console.log('Calendar date event triggered');\n\n    resolve(true);\n  }.bind(this))\n};\n\nexport default AnalyticsEvents;\n","import { scrollTo } from './scrollTo.js';\nimport AnalyticsEvents from '../analytics/analyticsEvents.js';\n\nconst analytics = new AnalyticsEvents( gtag );\n\nlet eventCategoryInputEls = document.getElementsByName('event_category');\nlet eventCategoryInputs = Array.from( eventCategoryInputEls );\neventCategoryInputs.forEach( function( input ){\n  input.addEventListener('change', (e) => { showCategoryEvents(e.target.value) } );\n  //check if already selected (when go back form is pre-filled)\n  if (input.checked) {\n    showCategoryEvents( input.value );\n  }\n});\n\nfunction showCategoryEvents( trgtClass ){\n  //show header\n  document.getElementById('choose-event-header').style.display = 'inline-block';\n  //hide and deselect all\n  let productInputEls = document.getElementsByClassName( 'event' );\n  let productInputs = Array.from( productInputEls );\n  let bookingStartForm = document.getElementById('booking-choose-event');\n  productInputs.forEach( function( input ){\n    input.checked = false;\n    input.style.display = 'none';\n    let productId = parseInt( input.value, 10);\n    let productName = input.getAttribute('data-product-name');\n    input.addEventListener( 'change', (e) => {\n      analytics.bookingStart( productId, productName )\n        .then( result => {\n          bookingStartForm.submit();\n        });\n    });\n  });\n\n  //show that category\n  let category = trgtClass;\n  let productCatInputEls = document.getElementsByClassName(category);\n  let productCatInputs = Array.from( productCatInputEls );\n  productCatInputs.forEach( function( input ){\n    input.style.display = 'inline-flex';\n  });\n\n  //scroll to\n  let eventsCont = document.getElementsByClassName('events')[0];\n  scrollTo( eventsCont, 160);\n}\n\n//party booking form\nif( document.getElementsByName('qty_extra').length > 0 ){\n\n  let extrasCheck = function( e ){\n    let max = parseInt(e.target.getAttribute('max'), 10);\n\n    if(e.target.value >= max){\n      [...qtyExtraEls].forEach( function( element ){\n        console.log(element);\n        element.disabled = false;\n      })\n    } else {\n      [...qtyExtraEls].forEach( function( element ){\n        console.log(element);\n        element.disabled = true;\n      })\n    }\n  }\n\n  let qtyInput = document.getElementById('qty_party_guests');\n  let qtyExtraEls = document.getElementsByClassName('party_extra_guests');\n\n  qtyInput.addEventListener( 'change', extrasCheck );\n\n}\n\n//change numbers input\nif( document.getElementById('qty_total') ){\n  document.getElementById('qty_total').addEventListener( 'change', e => { onQtyTotalChange(e) } );\n  document.getElementById('qty_total').addEventListener( 'change', e => { qtyValidations(e) } );\n}\n\nif( document.getElementById('qty_cadets') ){\n  document.getElementById('qty_cadets').addEventListener( 'change', e => { qtyValidations(e) } );\n}\n\nif( document.getElementById('qty_induction') ){\n  document.getElementById('qty_induction').addEventListener( 'change', e => { qtyValidations(e) } );\n}\n\nfunction onQtyTotalChange(e){\n  \n  let minNumberNewRes = e.target.getAttribute('data-min-new');\n  let qtyTotalNotice = null;\n  if( document.getElementsByClassName('qty-total-notice').length > 0 ){\n    qtyTotalNotice = document.getElementsByClassName('qty-total-notice')[0];\n    if( e.target.value < minNumberNewRes ){\n      qtyTotalNotice.style.display = 'inline-block';\n    } else {\n      qtyTotalNotice.style.display = 'none';\n    }\n  }\n\n}\n\nfunction qtyValidations(e) {\n\n  let totalQtyField = document.getElementById('qty_total');\n  let totalQty = parseInt(totalQtyField.value);\n  let cadetQtyField = document.getElementById('qty_cadets');\n  let cadetQty = parseInt(cadetQtyField.value);\n  let inductionQty = parseInt(document.getElementById('qty_induction').value); \n  let submitBtn = document.getElementById('booking-start-form-submit');\n\n  let cadetValidationMsg = null;\n  let inductionValidationMsg = null;\n\n  // handle cadets\n  if( document.getElementsByClassName('qty-cadet-validation').length > 0 ){\n    cadetValidationMsg = document.getElementsByClassName('qty-cadet-validation')[0];\n    if( totalQty < cadetQty ){\n      cadetValidationMsg.style.display = 'inline-block';\n      totalQtyField.style.borderColor = '#c01349';\n      submitBtn.disabled = true;\n    } else {\n      cadetValidationMsg.style.display = 'none';\n      totalQtyField.style.borderColor = '#575756';\n      submitBtn.disabled = false;\n    }\n  }\n\n  // handle inductions\n  if( document.getElementsByClassName('qty-induction-validation').length > 0 ){\n    inductionValidationMsg = document.getElementsByClassName('qty-induction-validation')[0];\n    if( cadetQty < inductionQty ){\n      inductionValidationMsg.style.display = 'inline-block';\n      cadetQtyField.style.borderColor = '#c01349';\n      submitBtn.disabled = true;\n    } else {\n      inductionValidationMsg.style.display = 'none';\n      cadetQtyField.style.borderColor = '#575756';\n      submitBtn.disabled = false;\n    }\n  }\n}\n\n//numbers chosen form submitted\nif( document.getElementById('booking-start-form-submit') ){\n  let bookingStartFormSubmit = document.getElementById('booking-start-form-submit');\n  let bookingStartForm = bookingStartFormSubmit.parentNode;\n  let formElements = bookingStartFormSubmit.parentNode.elements;\n  let productId = parseInt(formElements.prod.value, 10);\n  let totalParticipants = parseInt(formElements.qty_total.value, 10);\n  bookingStartFormSubmit.addEventListener( 'click', (e) => {\n    e.preventDefault();\n    analytics.numbersChosen( totalParticipants, productId )\n      .then( result => {\n        bookingStartForm.submit();\n      })\n  } )\n}\n","import Events from './scripts/booking/events.js';\nimport Event from './scripts/booking/event.js';\nimport EventType from './scripts/booking/eventType.js';\nimport EventReservation from './scripts/booking/eventReservation.js';\nimport Product from './scripts/booking/Product.js';\nimport Reservation from './scripts/booking/reservation.js';\nimport Schedule from './scripts/booking/schedule.js';\nimport Api from './scripts/utilities/api.js';\nimport './scripts/ui/bookingForms.js'; //ui js\nimport { showOverlay } from './scripts/utilities/overlay.js'; //ui js\nimport AnalyticsEvents from './scripts/analytics/analyticsEvents.js';\n\nconst analytics = new AnalyticsEvents( gtag );\n\n//BOOKING START FORM - GET EVENT AND PRODUCT DETAILS\nif ( typeof(viewType) !== 'undefined' && typeof(wcProductId) !== 'undefined' && eventTypeId && typeof(inductionEventTypeId) !== 'undefined' ){\n\n  if( viewType == 'booking-start'){\n\n    //api\n    const api = new Api();\n    let base_url = api.base_url;\n    let key = api.api;\n    let limit = api.limit;\n\n    //set event type and product objects\n    let eventType = new EventType( eventTypeId );\n    let product = null;\n    eventType.getEventTypeById( eventTypeId, api )\n      .then( eventType => {\n        //get online product details\n        product = new Product( eventType.onlineProductId );\n        return product.getProductById( eventType.onlineProductId, api )\n      })\n      .then( result => {\n        console.log(result);\n      })\n\n    //get/set induction details and edit dom on booking start form\n    let inductionEventType = new EventType( inductionEventTypeId );\n    let inductionProduct = null;\n    inductionEventType.getEventTypeById( inductionEventTypeId, api )\n      .then( eventType => {\n        // console.log(eventType);\n        //get online product details\n        inductionProduct = new Product( eventType.onlineProductId );\n        return inductionProduct.getProductById( eventType.onlineProductId, api )\n      })\n      .then( result => {\n        // console.log(inductionProduct);\n        //update dom\n        let inductionCostPlaceholdersEls = document.getElementsByClassName('induction_cost');\n        let inductionCostPlaceholders = Array.from(inductionCostPlaceholdersEls);\n        inductionCostPlaceholders.forEach( function( element ) {\n          element.innerHTML = '&pound;' + parseInt(inductionProduct.price1, 10).toFixed(2);\n        })\n      })\n  }\n}\n\n//SHOW EXISTING EVENTS\nif (typeof(wcProductId) !== 'undefined' && typeof(qtyTotal) !== 'undefined' && typeof(eventTypeId) !== 'undefined' && (viewType == 'calendar' || viewType == 'day') ){\n\n  //api\n  const api = new Api();\n  let base_url = api.base_url;\n  let key = api.api;\n  let limit = api.limit;\n\n  //get product ids from variations and Other Product Ids var\n  let otherProducts = [];\n  if(productTimeVariations.length){\n    productTimeVariations.forEach( function( timeVariation ){\n      otherProducts.push( {\n        id: timeVariation.product_id,\n        wcProductId: timeVariation.wc_product_id,\n        name: timeVariation.name,\n        price: timeVariation.price,\n        regularPrice: timeVariation.regular_price,\n        onSale: timeVariation.on_sale,\n        startTimes: timeVariation.product_start_times,\n        includedPeriods: timeVariation.included_periods,\n        other_product_ids: timeVariation.other_product_ids\n      } );\n    })\n  }\n\n  //induction info\n  if( qtyInduction > 0 ){\n    let inductionEventType = new EventType( inductionInfo.event_type_id );\n    let inductionProduct = null;\n    inductionEventType.getEventTypeById( inductionInfo.event_type_id, api )\n      .then( eventType => {\n        // console.log(eventType);\n        //get online product details\n        inductionProduct = new Product( eventType.onlineProductId );\n        return inductionProduct.getProductById( eventType.onlineProductId, api )\n      })\n      .then( result => {\n        inductionInfo.price = parseInt(inductionProduct.price1).toFixed(2);\n      })\n  }\n\n  //CONSTRUCT EVENTS WRAPPER OBJECT AND ADD DOM ELEMENTS\n  const EventsWrapper = new Events(wcProductId, wcEventTitle, qtyTotal, qtyCadets, qtyInduction, eventTypeId, siblingEventTypeIds, eventDayInfo, startDate, endDate, eventDuration, inductionInfo, currentUser, customerId, partyInfo, null, singleReservation, setTimesOnly, scheduleSettings, api, newReservations, myEvents, wcPrice, wcRegularPrice, onSale);\n\n  //view type day\n  if(viewType=='day'){\n\n    //MAIN TRACK\n    if ( document.getElementById( 'schedule' ) ){\n      //create schedule el\n      let scheduleEl = document.getElementById( 'schedule' );\n      EventsWrapper.schedule = new Schedule( scheduleEl, startDate, scheduleSettings.start, scheduleSettings.end, scheduleSettings.period, tracks, api );\n      //add loading spinners to column loading containers\n      EventsWrapper.schedule.startLoading( 0 );\n\n      EventsWrapper.getEventTypes( tracks.main )\n        .then( response => {\n          return EventsWrapper.getProducts( productId, otherProducts )\n        })\n        .then( result => {\n          EventsWrapper.product.wcName = wcEventTitle;\n        //   return EventsWrapper.setProductVariations( productTimeVariations )\n        // })\n        // .then( result => {\n          return EventsWrapper.constructEventReservations()\n        })\n        .then( result => {\n          return EventsWrapper.getMyEventInfo();\n        })\n        .then( result => {\n          //construct timeslots\n          EventsWrapper.constructTimeslots();\n          //fill timeslots\n          EventsWrapper.fillTimeslots();\n          //draw add buttons\n          let totalAddButtons = 0;\n          if( newReservations ){\n            totalAddButtons = EventsWrapper.drawAddButtons();\n          }\n          //draw events\n          let totalAvailableEvents = EventsWrapper.drawEvents();\n          //if no availability\n          if(totalAddButtons + totalAvailableEvents.available < 1){\n            EventsWrapper.schedule.trackWrappers.mainTrack.classList.add('no-availability')\n            //add text only if no hidden events\n            // console.log(totalAvailableEvents);\n            if( totalAvailableEvents.unavailable < 1 ){\n              let noAvailabilityNotice = document.createElement('p');\n              let noAvailabilityText = document.createTextNode('No availability on this date');\n              noAvailabilityNotice.appendChild( noAvailabilityText );\n              EventsWrapper.schedule.trackWrappers.mainTrack.appendChild( noAvailabilityNotice );\n            }\n          }\n          //removeSpinner\n          EventsWrapper.schedule.stopLoading( 0 );\n          console.log(EventsWrapper);\n          //call other tracks\n          if( tracks.other_tracks.length > 0 ){\n            EventsWrapper.schedule.renderOtherTracks( myEvents );\n          }\n\n          //load form automatically\n          if (typeof eventReservationIdFromURL !== 'undefined') {\n            if (eventReservationIdFromURL > 0) {\n              console.log(eventReservationIdFromURL);\n              EventsWrapper.showEventDetails({target: document.getElementById(eventReservationIdFromURL)}, null, eventReservationIdFromURL, isFamilyEvent);\n            }\n          }\n          \n        })\n        .catch( err => {\n          console.log( err );\n          //catch failed to fetch err\n          if( err.message.indexOf('Failed to fetch') > -1 ){\n            //message box elements\n            let messageBox = document.createElement('div');\n            let messagePara = document.createElement('p');\n            messagePara.innerHTML = 'We\\'re having some problems communicating with our booking system, sorry! Please try again later, or call us on <a href=\"tel:01915214050\">0191 521 4050</a>.';\n            let homeLink = document.createElement('a');\n            let homeLinkText = document.createTextNode('Return to homepage');\n            homeLink.href = '/';\n            homeLink.appendChild( homeLinkText );\n            messageBox.appendChild( messagePara );\n            messageBox.appendChild( homeLink );\n            showOverlay( true, false, messageBox )\n          }\n        })\n    }\n\n  } else {\n    //month or other view type\n    //fetch data from api\n    EventsWrapper.getEventTypes( tracks.main )\n      .then( response => {\n        return EventsWrapper.getProducts( productId, otherProducts )\n      })\n      // .then( result => {\n      //   return EventsWrapper.setProductVariations( productTimeVariations )\n      // })\n      .then( result => {\n        return EventsWrapper.constructEventReservations()\n      })\n      .then( result => {\n        //construct timeslots\n        EventsWrapper.constructTimeslots();\n        //fill timeslots\n        EventsWrapper.fillTimeslots();\n        //check availability\n        EventsWrapper.checkAvailability();\n        console.log(EventsWrapper);\n      })\n      .catch( err => {\n        console.log( err );\n      })\n\n    //target dom elements for aanlytics events\n    if( document.getElementsByClassName('calendar').length > 0 ){\n      let dayEls = document.getElementsByClassName('day');\n      [...dayEls].forEach( dayEl => {\n        let date = dayEl.getAttribute('data-date');\n        [...dayEl.children].forEach( child => {\n          if( child.tagName == 'A' ){\n            let href = child.href;\n            child.addEventListener('click', (e) => {\n              e.preventDefault();\n              analytics.calendarDateChosen( date )\n                .then( result => {\n                  window.location.href = href;\n                })\n            });\n          }\n        })\n      })\n    }\n  }\n}\n"],"sourceRoot":""}